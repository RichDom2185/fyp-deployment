import{M as e,O as t,b as n,f as r,j as i,l as a,p as o,q as s,r as c,u as l}from"./index-BhFOQNBT.js";import{b as u}from"./createLucideIcon-fTqSzsiU.js";import{b as d}from"./chevrons-up-down-Cj4NjeI8.js";import{b as f}from"./plus-BLbU8cih.js";import"./x-C4RdNn0_.js";import{g as p}from"./dist-BWP1BH0m.js";import"./dist-ztOuzjD-.js";import"./dist-D522ueSb.js";import{b as m}from"./button-D5Dzo2oi.js";import"./dist-nqO5qK0j.js";import"./dist-CCQcB0uV.js";import"./es2015-BEh5Ludu.js";import"./dist-D0EIbawx.js";import{b as h,d as g,g as _,h as v,i as y}from"./dialog-B0p4r4sh.js";import{b}from"./input-DOmlsFvp.js";import{b as x}from"./label-CMX14k_v.js";import{b as S}from"./separator-D2MLSFpl.js";const C=[[`path`,{d:`M10 11v6`,key:`nco0om`}],[`path`,{d:`M14 11v6`,key:`outv1u`}],[`path`,{d:`M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6`,key:`miytrc`}],[`path`,{d:`M3 6h18`,key:`d0wm0j`}],[`path`,{d:`M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2`,key:`e791ji`}]],w=u(`trash-2`,C);var T=t(e()),E=t(l());const D=(({conversations:e,currentConversationId:t,onDelete:n})=>{let r=c().courseId;return(0,E.jsx)(`div`,{className:`space-y-2`,children:e.length===0?(0,E.jsx)(`p`,{className:`text-sm text-gray-500 text-center py-8`,children:`No conversations yet. Start a new chat!`}):e.map(e=>(0,E.jsxs)(i,{to:`/courses/${r}/chat/${e.id}`,className:p(`flex items-center gap-2 rounded-lg p-3 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors`,t===e.id&&`bg-gray-100 dark:bg-gray-800`),children:[(0,E.jsx)(`span`,{className:`flex-1 min-w-0`,children:(0,E.jsx)(`div`,{className:`text-sm font-medium truncate`,children:e.title})}),n&&(0,E.jsx)(m,{variant:`ghost`,size:`icon`,className:`h-8 w-8 shrink-0 cursor-pointer hover:text-red-600`,onClick:t=>{t.preventDefault(),n(e.id)},children:(0,E.jsx)(w,{className:`h-4 w-4`})})]},e.id))})});var O=D;const k=(({isDialogOpen:e,hideTrigger:t=!1,setIsDialogOpen:n,handleCreateConversation:r})=>{let[i,a]=(0,T.useState)(``),[o,s]=(0,T.useState)(!1),c=async e=>{if(!e.trim()){window.alert(`Chat title cannot be empty`);return}s(!0);try{await r(e)}catch(e){console.error(`Failed to create conversation:`,e),window.alert(`Failed to create conversation`)}finally{s(!1)}};return(0,E.jsxs)(h,{open:e,onOpenChange:n,children:[!t&&(0,E.jsx)(y,{asChild:!0,children:(0,E.jsxs)(m,{className:`w-full`,children:[(0,E.jsx)(f,{className:`h-4 w-4 mr-2`}),`New Chat`]})}),(0,E.jsxs)(g,{children:[(0,E.jsx)(_,{children:(0,E.jsx)(v,{children:`Start a New Chat`})}),(0,E.jsxs)(`div`,{className:`space-y-4 pt-4`,children:[(0,E.jsxs)(`div`,{className:`space-y-2`,children:[(0,E.jsx)(x,{htmlFor:`title`,children:`Chat Title`}),(0,E.jsx)(b,{id:`title`,value:i,onChange:e=>a(e.target.value),placeholder:`e.g., Midterm Discussion Summary`,onKeyDown:e=>{e.key===`Enter`&&c(i)}})]}),(0,E.jsx)(m,{onClick:()=>c(i),disabled:!i.trim()||o,className:`w-full`,children:`Create Chat`})]})]})]})});var A=k;const j=(({open:e,onOpenChange:t,title:n,trigger:r,children:i})=>(0,E.jsxs)(h,{open:e,onOpenChange:t,children:[(0,E.jsx)(y,{asChild:!0,children:r}),(0,E.jsxs)(g,{className:`sm:max-w-lg w-full`,children:[(0,E.jsx)(_,{children:(0,E.jsx)(v,{children:n})}),(0,E.jsx)(`div`,{children:i})]})]}));var M=j;const N={sm:0,md:1,lg:2,xl:3,xxl:4},P=[640,768,1024,1280,1536],F=e=>{let t=P.length-1,n=t;for(;n>=0&&!(e>=P[n]);n--);return n},I=()=>{let[e,t]=(0,T.useState)(F(window.innerWidth));(0,T.useEffect)(()=>{let e=()=>{window.requestAnimationFrame(()=>{t(F(window.innerWidth))})};return window.addEventListener(`resize`,e),window.addEventListener(`orientationchange`,e),()=>{window.removeEventListener(`resize`,e),window.removeEventListener(`orientationchange`,e)}},[]);let n=(0,T.useMemo)(()=>Object.fromEntries(Object.keys(N).map((t,n)=>[t,n<=e])),[e]);return n},L=()=>{let e=c(),t=e.courseId,i=e.conversationId===void 0?void 0:Number(e.conversationId),s=r(e=>e.courses.currentCourseId),[l,u]=(0,T.useState)([]),p=o();(0,T.useEffect)(()=>{let e=async()=>{if(s)try{let e=await n.GET(`/api/v1/conversations`,{params:{query:{courseId:s}}});e.data&&u(e.data.conversations)}catch(e){console.error(`Failed to load conversations:`,e)}};e()},[s]);let h=async e=>{if(!e.trim()||!s)return;let r=await n.POST(`/api/v1/conversations`,{body:{title:e.trim(),courseId:s}});r.data&&(u([...l,r.data]),v(!1),p(`/courses/${t}/chat/${r.data.id}`))},g=async e=>{if(confirm(`Are you sure you want to delete this conversation?`))try{await n.DELETE(`/api/v1/conversations/{conversationId}`,{params:{path:{conversationId:e}}}),u(l.filter(t=>t.id!==e)),e===i&&p(`/courses/${t}/chat`)}catch(e){console.error(`Failed to delete conversation:`,e),window.alert(`Failed to delete conversation`)}},[_,v]=(0,T.useState)(!1),[y,b]=(0,T.useState)(!1),{md:x}=I();(0,T.useEffect)(()=>{i!==void 0&&b(!1)},[i]);let C=()=>v(!0);return x?(0,E.jsxs)(`div`,{className:`flex h-[calc(100vh-4rem)]`,children:[(0,E.jsxs)(`div`,{className:`w-80 border-r flex flex-col`,children:[(0,E.jsx)(`div`,{className:`p-4 border-b`,children:(0,E.jsx)(A,{isDialogOpen:_,setIsDialogOpen:v,handleCreateConversation:h})}),(0,E.jsx)(`div`,{className:`p-4 h-full overflow-y-auto`,children:(0,E.jsx)(O,{conversations:l,currentConversationId:i,onDelete:g})})]}),(0,E.jsx)(a,{context:{openCreateDialog:C}})]}):(0,E.jsxs)(`div`,{className:`flex flex-col h-[calc(100vh-4rem)]`,children:[(0,E.jsx)(`div`,{className:`shrink-0 border-b pb-4`,children:(0,E.jsx)(M,{open:y,onOpenChange:b,title:`Select Chat`,trigger:(0,E.jsxs)(m,{variant:`ghost`,role:`combobox`,className:`gap-x-2 text-lg font-semibold h-8 py-4 mx-4 cursor-pointer`,children:[(0,E.jsx)(d,{className:`-ml-1 h-4 w-4 shrink-0 opacity-50`}),l.find(e=>e.id===i)?.title??`Select Chat`]}),children:(0,E.jsxs)(`div`,{className:`space-y-4`,children:[(0,E.jsxs)(m,{className:`w-full`,onClick:C,children:[(0,E.jsx)(f,{className:`h-4 w-4 mr-2`}),`New Chat`]}),(0,E.jsx)(S,{}),(0,E.jsx)(O,{conversations:l,currentConversationId:i,onDelete:g})]})})}),(0,E.jsxs)(`div`,{className:`flex-1 h-full flex overflow-y-auto`,children:[(0,E.jsx)(A,{hideTrigger:!0,isDialogOpen:_,setIsDialogOpen:v,handleCreateConversation:e=>(b(!1),h(e))}),(0,E.jsx)(a,{context:{openCreateDialog:C}})]})]})},R=()=>s(),z=L;z.displayName=`ChatLayout`;var B=z;export{z as Component,B as default,R as useCreateChatDialog};