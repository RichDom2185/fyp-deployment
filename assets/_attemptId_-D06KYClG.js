import{K as e,T as t,Z as n,h as r,n as i,s as a,x as o,y as s}from"./index-De71N5Dy.js";import{t as c}from"./button-DPMtwoy8.js";import{t as l}from"./label-BYyMeIUc.js";var u=n(e()),d=n(t()),f=({questions:e,answers:t,onAnswerChange:n,onSubmit:r,onCancel:i,isSubmitting:a=!1})=>{let o=[...e].sort((e,t)=>e.order-t.order),s=e=>{let r=t[e.id];switch(e.questionType){case`multiple_choice`:return(0,d.jsx)(`div`,{className:`space-y-2`,children:e.options?.map((t,i)=>{let a=(Array.isArray(r)?r:[]).includes(i);return(0,d.jsxs)(`label`,{className:`flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors`,children:[(0,d.jsx)(`input`,{type:`radio`,name:`question-${e.id}`,checked:a,onChange:()=>{n(e.id,[i])},className:`h-4 w-4`}),(0,d.jsx)(`span`,{children:t})]},i)})});case`short_answer`:return(0,d.jsx)(`textarea`,{value:r??``,onChange:t=>n(e.id,t.target.value),className:`w-full min-h-[100px] p-3 border rounded-lg`,placeholder:`Enter your answer here...`});default:return null}};return(0,d.jsxs)(`div`,{className:`space-y-6`,children:[o.map((e,t)=>(0,d.jsxs)(`div`,{className:`p-6 border rounded-lg`,children:[(0,d.jsxs)(`div`,{className:`flex items-start justify-between mb-4`,children:[(0,d.jsxs)(l,{className:`text-base font-semibold`,children:[`Question `,t+1]}),(0,d.jsxs)(`span`,{className:`text-sm text-muted-foreground`,children:[e.points,` `,e.points===1?`point`:`points`]})]}),(0,d.jsx)(`p`,{className:`mb-4 text-base`,children:e.questionText}),s(e)]},e.id)),(0,d.jsxs)(`div`,{className:`flex gap-2 justify-end pt-4 sticky bottom-0 bg-background border-t p-4`,children:[(0,d.jsx)(c,{type:`button`,variant:`outline`,onClick:i,disabled:a,children:`Cancel`}),(0,d.jsx)(c,{onClick:r,disabled:a,children:a?`Submitting...`:`Submit Quiz`})]})]})};function p(){let{quizId:e,attemptId:t}=o(),n=e?parseInt(e,10):null,l=t?parseInt(t,10):null,p=a(e=>e.courses.currentCourseId),m=s(),[h,g]=(0,u.useState)(null),[_,v]=(0,u.useState)({}),[y,b]=(0,u.useState)(!0),[x,S]=(0,u.useState)(!1),[C,w]=(0,u.useState)(!1),T=r(({currentLocation:e,nextLocation:t})=>!C&&!x&&h!==null&&e.pathname!==t.pathname);(0,u.useEffect)(()=>{(async()=>{if(!(!p||!n||!l)){b(!0);try{let e=await i.POST(`/api/v1/courses/{courseId}/quizzes/{quizId}/attempts`,{params:{path:{courseId:p,quizId:n}}});e.data&&e.data.id===l?g(e.data):m(`/courses/${p}/quizzes/${n}`)}catch(e){console.error(`Failed to fetch attempt:`,e),m(`/courses/${p}/quizzes/${n}`)}finally{b(!1)}}})()},[p,n,l,m]);let E=(e,t)=>{v(n=>({...n,[e]:t}))},D=async()=>{if(!(!p||!n||!l)){S(!0);try{await Promise.all(Object.entries(_).map(([e,t])=>i.POST(`/api/v1/courses/{courseId}/quizzes/{quizId}/attempts/{attemptId}/answers/{questionId}`,{params:{path:{courseId:p,quizId:n,attemptId:l,questionId:parseInt(e,10)}},body:{answer:t}}))),await i.POST(`/api/v1/courses/{courseId}/quizzes/{quizId}/attempts/{attemptId}/complete`,{params:{path:{courseId:p,quizId:n,attemptId:l}}}),w(!0),m(`/courses/${p}/quizzes/${n}`)}catch(e){console.error(`Failed to submit quiz:`,e)}finally{S(!1)}}},O=()=>{window.confirm(`Are you sure you want to leave? Your progress will be saved but the attempt will remain in progress.`)&&m(`/courses/${p}/quizzes/${n}`)};return(0,u.useEffect)(()=>{T.state===`blocked`&&(window.confirm(`You have an in-progress quiz attempt. Are you sure you want to leave? Your progress will be saved.`)?T.proceed():T.reset())},[T]),y?(0,d.jsx)(`div`,{className:`max-w-5xl mx-auto px-6 pb-8 h-[calc(100vh-4rem)] overflow-y-auto`,children:(0,d.jsx)(`div`,{className:`flex items-center justify-center pt-8`,children:(0,d.jsx)(`p`,{className:`text-muted-foreground`,children:`Loading quiz...`})})}):h?(0,d.jsxs)(`div`,{className:`max-w-5xl mx-auto px-6 pb-8 h-[calc(100vh-4rem)] overflow-y-auto`,children:[(0,d.jsxs)(`div`,{className:`sticky top-0 bg-background pt-8 pb-4 z-10`,children:[(0,d.jsx)(c,{variant:`ghost`,onClick:O,className:`mb-4`,children:`‚Üê Back to Quiz`}),(0,d.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Quiz Attempt`})]}),(0,d.jsx)(f,{questions:h.questions,answers:_,onAnswerChange:E,onSubmit:D,onCancel:O,isSubmitting:x})]}):(0,d.jsx)(`div`,{className:`max-w-5xl mx-auto px-6 pb-8 h-[calc(100vh-4rem)] overflow-y-auto`,children:(0,d.jsx)(`div`,{className:`flex items-center justify-center pt-8`,children:(0,d.jsx)(`p`,{className:`text-muted-foreground`,children:`Attempt not found.`})})})}const m=p;export{m as Component};