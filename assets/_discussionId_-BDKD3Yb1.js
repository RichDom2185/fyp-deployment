import{H as e,K as t,W as n,a as r,g as i,n as a,s as o,w as s,x as c}from"./index-DkHy_0vr.js";import{t as l}from"./RichTextEditor-Bzrf3iTD.js";import{n as u,r as d,t as f}from"./card-BBO2aCaD.js";import{t as p}from"./button-CVZMqZS2.js";import"./shim-CTE6O2qI.js";import{n as m,r as h,t as g}from"./avatar-DgTxZQgq.js";import"./tooltip-rsStB9Uj.js";import{t as _}from"./RelativeTime-DWnDX8Ey.js";import{t as v}from"./separator-BzoXs7wx.js";import{t as y}from"./RichTextViewer-CqBrviKX.js";var b=t(e()),x=t(n()),S=t(s());function C(e){return new Date(e).toLocaleString()}var w=(({post:e,nesting:t=0,onReply:n})=>{let[r,i]=(0,x.useState)(!1),a=(0,x.useRef)(null);return(0,S.jsxs)(`div`,{style:{marginLeft:t*24,marginTop:16},children:[(0,S.jsxs)(f,{children:[(0,S.jsxs)(d,{className:`flex items-center gap-2`,children:[(0,S.jsxs)(g,{children:[(0,S.jsx)(h,{src:e.author.avatarUrl,alt:e.author.name}),(0,S.jsx)(m,{children:e.author.name.charAt(0)})]}),(0,S.jsx)(`span`,{className:`font-semibold`,children:e.author.name}),(0,S.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:C(e.createdAt)})]}),(0,S.jsxs)(u,{className:`space-y-4`,children:[(0,S.jsx)(y,{htmlContent:e.content}),r?(0,S.jsxs)(`div`,{children:[(0,S.jsx)(l,{ref:a}),(0,S.jsxs)(`div`,{className:`flex gap-2 mt-2`,children:[(0,S.jsx)(p,{size:`sm`,onClick:()=>{let t=a.current?.getHtmlContent();t&&(n(e.id,t),i(!1))},children:`Post Reply`}),(0,S.jsx)(p,{size:`sm`,variant:`ghost`,onClick:()=>i(!1),children:`Cancel`})]})]}):(0,S.jsx)(`div`,{children:(0,S.jsx)(p,{size:`sm`,variant:`outline`,onClick:()=>i(!0),children:`Reply`})})]})]}),e.replies?.map(e=>(0,S.jsx)(w,{post:e,nesting:t+1,onReply:n},e.id))]})}),T=w;const E={breadcrumb:e=>{let{discussionId:t}=e.params,n=r.getState().discussions.discussions.find(e=>e.id.toString()===t)?.title;return n?`Discussion: ${n}`:void 0}},D=(async({params:e})=>{let{discussionId:t}=e;return(await a.GET(`/api/v1/discussions/{discussionId}/posts`,{params:{path:{discussionId:Number(t)}}})).data});var O=async(e,t,n)=>await a.POST(`/api/v1/discussions/{discussionId}/reply`,{params:{path:{discussionId:Number(e)}},body:{content:t,parentId:n}});const k=()=>{let e=i(),t=(0,x.useRef)(null),[n,r]=(0,x.useState)(e.posts),{discussionId:a}=c(),s=o(e=>e.discussions.discussions.find(e=>e.id.toString()===a));if((0,x.useEffect)(()=>{r(e.posts)},[e.posts]),!s)return(0,S.jsx)(`div`,{children:`Discussion not found`});let u=(0,b.default)(s.createdAt),d=(0,b.default)(s.updatedAt),f=async()=>{let e=t.current?.getHtmlContent();if(!e)return;let i=await O(Number(a),e,null);i.data&&(r([...n,i.data]),t.current?.clearContent())},y=async(e,t)=>{let i=await O(Number(a),t,e);if(!i.data)return;let o=t=>t.map(t=>t.id===e?{...t,replies:t.replies?[...t.replies,i.data]:[i.data]}:t.replies?{...t,replies:o(t.replies)}:t);r(o(n))};return(0,S.jsxs)(`div`,{className:`max-w-3xl mx-auto py-8`,children:[(0,S.jsx)(`h1`,{className:`text-3xl font-bold mb-2`,children:s.title}),(0,S.jsx)(`p`,{className:`text-muted-foreground mb-4`,children:s.description}),(0,S.jsxs)(`div`,{className:`text-sm text-muted-foreground flex items-center gap-2 mb-4`,children:[(0,S.jsx)(`span`,{children:u.format(`lll`)}),(0,S.jsx)(`span`,{children:`Â·`}),(0,S.jsxs)(`span`,{children:[`Last updated `,(0,S.jsx)(_,{timestamp:d})]})]}),(0,S.jsx)(`div`,{className:`flex items-center gap-x-4 mb-4`,children:(0,S.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,S.jsxs)(g,{children:[(0,S.jsx)(h,{src:s.author.avatarUrl,alt:s.author.name}),(0,S.jsx)(m,{children:s.author.name.charAt(0)})]}),(0,S.jsx)(`span`,{className:`font-semibold`,children:s.author.name})]})}),(0,S.jsx)(v,{className:`mb-6`}),(0,S.jsx)(`div`,{className:`space-y-6`,children:n.map(e=>(0,S.jsx)(T,{post:e,onReply:y},e.id))}),n.length>0?(0,S.jsx)(v,{className:`my-8`}):(0,S.jsx)(`p`,{className:`text-muted-foreground my-8 text-center italic`,children:`Add your first post below!`}),(0,S.jsxs)(`div`,{children:[(0,S.jsx)(`h2`,{className:`text-xl font-semibold mb-2`,children:`Add a new post`}),(0,S.jsx)(l,{ref:t}),(0,S.jsx)(p,{className:`mt-2`,onClick:f,children:`Post`})]})]})};k.displayName=`DiscussionId`;var A=k;export{k as Component,A as default,E as handle,D as loader};