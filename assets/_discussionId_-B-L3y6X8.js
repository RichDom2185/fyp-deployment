import{K as e,T as t,W as n,Z as r,a as i,g as a,n as o,s,x as c}from"./index-De71N5Dy.js";import{t as l}from"./button-DPMtwoy8.js";import{t as u}from"./RichTextEditor-DIUjZ3l2.js";import{t as d}from"./separator-BrSnISek.js";import"./tooltip-B1ArGQNb.js";import"./shim-CKHktkII.js";import{n as f,r as p,t as m}from"./avatar-D_PmZzLC.js";import{a as h,n as g,t as _}from"./card-D2-K7jj_.js";import{t as v}from"./RelativeTime-BJvf6Ij-.js";import{t as y}from"./RichTextViewer-CQ91QE7h.js";var b=r(n()),x=r(e()),S=r(t());function C(e){return new Date(e).toLocaleString()}function w({post:e,nesting:t=0,onReply:n}){let[r,i]=(0,x.useState)(!1),a=(0,x.useRef)(null);return(0,S.jsxs)(`div`,{style:{marginLeft:t*24,marginTop:16},children:[(0,S.jsxs)(_,{children:[(0,S.jsxs)(h,{className:`flex items-center gap-2`,children:[(0,S.jsxs)(m,{children:[(0,S.jsx)(p,{src:e.author.avatarUrl,alt:e.author.name}),(0,S.jsx)(f,{children:e.author.name.charAt(0)})]}),(0,S.jsx)(`span`,{className:`font-semibold`,children:e.author.name}),(0,S.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:C(e.createdAt)})]}),(0,S.jsxs)(g,{className:`space-y-4`,children:[(0,S.jsx)(y,{htmlContent:e.content}),r?(0,S.jsxs)(`div`,{children:[(0,S.jsx)(u,{ref:a}),(0,S.jsxs)(`div`,{className:`flex gap-2 mt-2`,children:[(0,S.jsx)(l,{size:`sm`,onClick:()=>{let t=a.current?.getHtmlContent();t&&(n(e.id,t),i(!1))},children:`Post Reply`}),(0,S.jsx)(l,{size:`sm`,variant:`ghost`,onClick:()=>i(!1),children:`Cancel`})]})]}):(0,S.jsx)(`div`,{children:(0,S.jsx)(l,{size:`sm`,variant:`outline`,onClick:()=>i(!0),children:`Reply`})})]})]}),e.replies?.map(e=>(0,S.jsx)(w,{post:e,nesting:t+1,onReply:n},e.id))]})}var T=w;const E={breadcrumb:e=>{let{discussionId:t}=e.params,n=i.getState().discussions.discussions.find(e=>e.id.toString()===t)?.title;return n?`Discussion: ${n}`:void 0}},D=(async({params:e})=>{let{discussionId:t}=e;return(await o.GET(`/api/v1/discussions/{discussionId}/posts`,{params:{path:{discussionId:Number(t)}}})).data});var O=async(e,t,n)=>await o.POST(`/api/v1/discussions/{discussionId}/reply`,{params:{path:{discussionId:Number(e)}},body:{content:t,parentId:n}});function k(){let e=a(),t=(0,x.useRef)(null),[n,r]=(0,x.useState)(e.posts),{discussionId:i}=c(),o=s(e=>e.discussions.discussions.find(e=>e.id.toString()===i));if((0,x.useEffect)(()=>{r(e.posts)},[e.posts]),!o)return(0,S.jsx)(`div`,{children:`Discussion not found`});let h=(0,b.default)(o.createdAt),g=(0,b.default)(o.updatedAt),_=async()=>{let e=t.current?.getHtmlContent();if(!e)return;let a=await O(Number(i),e,null);a.data&&(r([...n,a.data]),t.current?.clearContent())},y=async(e,t)=>{let a=await O(Number(i),t,e);if(!a.data)return;let o=t=>t.map(t=>t.id===e?{...t,replies:t.replies?[...t.replies,a.data]:[a.data]}:t.replies?{...t,replies:o(t.replies)}:t);r(o(n))};return(0,S.jsxs)(`div`,{className:`max-w-3xl mx-auto py-8`,children:[(0,S.jsx)(`h1`,{className:`text-3xl font-bold mb-2`,children:o.title}),(0,S.jsx)(`p`,{className:`text-muted-foreground mb-4`,children:o.description}),(0,S.jsxs)(`div`,{className:`text-sm text-muted-foreground flex items-center gap-2 mb-4`,children:[(0,S.jsx)(`span`,{children:h.format(`lll`)}),(0,S.jsx)(`span`,{children:`Â·`}),(0,S.jsxs)(`span`,{children:[`Last updated `,(0,S.jsx)(v,{timestamp:g})]})]}),(0,S.jsx)(`div`,{className:`flex items-center gap-x-4 mb-4`,children:(0,S.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,S.jsxs)(m,{children:[(0,S.jsx)(p,{src:o.author.avatarUrl,alt:o.author.name}),(0,S.jsx)(f,{children:o.author.name.charAt(0)})]}),(0,S.jsx)(`span`,{className:`font-semibold`,children:o.author.name})]})}),(0,S.jsx)(d,{className:`mb-6`}),(0,S.jsx)(`div`,{className:`space-y-6`,children:n.map(e=>(0,S.jsx)(T,{post:e,onReply:y},e.id))}),n.length>0?(0,S.jsx)(d,{className:`my-8`}):(0,S.jsx)(`p`,{className:`text-muted-foreground my-8 text-center italic`,children:`Add your first post below!`}),(0,S.jsxs)(`div`,{children:[(0,S.jsx)(`h2`,{className:`text-xl font-semibold mb-2`,children:`Add a new post`}),(0,S.jsx)(u,{ref:t}),(0,S.jsx)(l,{className:`mt-2`,onClick:_,children:`Post`})]})]})}const A=k;export{A as Component,E as handle,D as loader};