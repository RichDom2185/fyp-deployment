import{a as e,f as t,i as n,l as r,n as i,p as a,r as o,t as s,u as c}from"./index-7VbmLvrz.js";import{t as l}from"./iconify-CDQ3uY1k.js";import{t as u}from"./clsx-DMxib4s8.js";import{n as d}from"./time-OjpbXJb1.js";var f=a(t(),1),p=a(e(),1);function m({roomCode:e,timeRemaining:t}){let[n,r,i]=d(t);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(`h1`,{className:`text-xl font-bold`,children:`Room Code:`}),(0,p.jsx)(`p`,{className:`font-mono text-4xl`,children:e}),(0,p.jsx)(`p`,{children:`Time Remaining:`}),(0,p.jsxs)(`p`,{className:`font-bold text-2xl`,children:[n.toString().padStart(2,`0`),`:`,r.toString().padStart(2,`0`),`:`,i.toString().padStart(2,`0`)]})]})}var h=m,g=()=>navigator.mediaDevices.getUserMedia({audio:!0});const _=({onStart:e,onStop:t,onData:n})=>{let[r,i]=(0,f.useState)(null);(0,f.useEffect)(()=>{r&&(r.ondataavailable=e=>{e.data.size>0&&n(e.data)})},[r,n]);let a=(0,f.useCallback)(async()=>{try{let e=await g(),t=new MediaRecorder(e,{mimeType:o});i(t),t.start(100)}catch(e){console.error(`Error accessing microphone:`,e)}},[]),s=(0,f.useCallback)(()=>{r?.state===`recording`&&r.stop(),r?.stream.getTracks().forEach(e=>e.stop())},[r]);return{start:(0,f.useCallback)(()=>{a(),e?.()},[a]),stop:(0,f.useCallback)(()=>{s(),t?.()},[s])}};var v={RTS(e){return`RTS${e}`},CTS:`CTS`,STOP:`STOP`,RESET:`RESET`};const y=(e,t)=>{let[n,r]=(0,f.useState)(`off`),[i,a]=(0,f.useState)(null);(0,f.useEffect)(()=>{let t=new WebSocket(e);return t.onopen=()=>{console.debug(`Connected to server`)},t.onclose=()=>{console.debug(`Disconnected from server`)},t.onmessage=({data:e})=>{console.debug(`Received message => ${e}`),e===v.CTS?r(()=>`on`):e===v.RESET&&r(()=>`off`)},a(t),()=>{console.debug(`Closing connection to server`),t.close(),a(null)}},[e]);let o=(0,f.useCallback)(e=>{i?.readyState===WebSocket.OPEN&&i.send(e)},[i]);return{state:n,send:(0,f.useCallback)(e=>{n===`on`&&o(e)},[o,n]),beginStream:(0,f.useCallback)(()=>{r(()=>`waiting`),o(v.RTS(t))},[o,t]),endStream:(0,f.useCallback)(()=>{o(v.STOP),r(()=>`off`)},[o])}};function b(){let{roomId:e}=c(),{state:t,send:a,beginStream:o,endStream:d}=y(`${n}/${e}`,`anonymous`),{start:m,stop:g}=_({onData:a}),v=r(),[b,x]=(0,f.useState)(2**53-1);(0,f.useEffect)(()=>{(async()=>{let t=await i.rooms.getTtl(e);if(!t){s.auth.setUserId(null),v(`/`);return}x(t)})();let t=setInterval(()=>{x(e=>e<=1e3?(s.auth.setUserId(null),v(`/`),0):e-1e3)},1e3);return()=>{clearInterval(t),x(2**53-1)}},[v,e]);let[S,C]=(0,f.useState)(!1);return(0,f.useEffect)(()=>{S&&t===`on`?m():g()},[t,S]),(0,p.jsxs)(`div`,{className:`space-y-4 text-center`,children:[(0,p.jsx)(h,{roomCode:e,timeRemaining:b}),(0,p.jsx)(`hr`,{className:`w-96 mx-auto`}),(0,p.jsxs)(`div`,{className:`flex flex-col gap-y-4 justify-center items-center h-96`,children:[(0,p.jsx)(`button`,{className:u(`w-40 h-40 rounded-full text-white font-bold`,`text-7xl flex justify-center items-center`,t===`on`&&`bg-green-500`,t===`waiting`&&`bg-orange-500`,t===`off`&&`bg-blue-500`),onClick:()=>{S?d():o(),C(e=>!e)},children:(0,p.jsx)(l,{icon:`tabler:microphone`})}),(0,p.jsx)(`p`,{children:t})]}),(0,p.jsx)(`button`,{className:u(`px-4 py-2 bg-red-500 text-white`,`font-semibold`,`hover:bg-red-600 rounded-lg`),onClick:()=>{s.auth.setUserId(null),v(`/`)},children:`Leave`})]})}const x=b;export{x as Component};