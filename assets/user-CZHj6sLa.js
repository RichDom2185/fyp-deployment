import{b as e}from"./useQuery-L5Xtx9Ga.js";import{K as t,M as n,O as r,b as i,f as a,j as o,u as s}from"./index-BhFOQNBT.js";import{b as c}from"./createLucideIcon-fTqSzsiU.js";import{b as l}from"./users-1BsW2uDC.js";import"./dist-BWP1BH0m.js";import"./card-OqURSol_.js";import{b as u,c as d}from"./TableWidget-BJfg-Ety.js";import"./dist-ztOuzjD-.js";import"./dist-D522ueSb.js";import"./dist-edC1SBHW.js";const f=[[`path`,{d:`M12.586 12.586 19 19`,key:`ea5xo7`}],[`path`,{d:`M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z`,key:`277e5u`}]],p=c(`mouse-pointer`,f),m=[[`path`,{d:`M3 7V5a2 2 0 0 1 2-2h2`,key:`aa7l1z`}],[`path`,{d:`M17 3h2a2 2 0 0 1 2 2v2`,key:`4qcy5o`}],[`path`,{d:`M21 17v2a2 2 0 0 1-2 2h-2`,key:`6vwrx8`}],[`path`,{d:`M7 21H5a2 2 0 0 1-2-2v-2`,key:`ioqczr`}],[`circle`,{cx:`12`,cy:`12`,r:`1`,key:`41hilf`}],[`path`,{d:`M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0`,key:`11ak4c`}]],h=c(`scan-eye`,m),g=[[`path`,{d:`M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6`,key:`y09zxi`}],[`path`,{d:`m21 3-9 9`,key:`mpx6sq`}],[`path`,{d:`M15 3h6v6`,key:`1q9fwt`}]],_=c(`square-arrow-out-up-right`,g);var v=r(t()),y=r(n());function b(t,n,r){let{isLoading:a,data:o}=e({queryKey:[`analytics`,`user`,`active-users-over-time`,t,n,r],queryFn:async()=>{let e=await i.GET(`/api/v1/analytics/user/active-users-over-time`,{params:{query:{courseId:t,startDate:n,endDate:r}}});return e.data.data}});return{isLoading:a,data:o||[]}}function x(t,n,r){let{isLoading:a,data:o}=e({queryKey:[`analytics`,`user`,`clicks`,t,n,r],queryFn:async()=>{let e=await i.GET(`/api/v1/analytics/user/clicks`,{params:{query:{courseId:t,startDate:n,endDate:r}}});return e.data}});return{isLoading:a,data:o}}function S(t,n,r){let{isLoading:a,data:o}=e({queryKey:[`analytics`,`user`,`page-views`,t,n,r],queryFn:async()=>{let e=await i.GET(`/api/v1/analytics/user/page-views`,{params:{query:{courseId:t,startDate:n,endDate:r}}});return e.data}});return{isLoading:a,data:o}}var C=r(s());const w={breadcrumb:`User Analytics`},T=()=>{let[e,t]=(0,y.useState)(0),n=a(e=>e.courses.currentCourseId),[r,s]=(0,y.useState)((0,v.default)().subtract(30,`day`)),[c,f]=(0,y.useState)((0,v.default)());(0,y.useEffect)(()=>{if(!n)return;let e=async()=>{try{let e=await i.GET(`/api/v1/analytics/user/active-users`,{params:{query:{courseId:n,startDate:r.toISOString(),endDate:c.toISOString()}}});e.data&&t(e.data.count)}catch(e){console.error(`Failed to fetch user analytics:`,e)}};e()},[n,c,r]);let{data:m}=b(n,r.toISOString(),c.toISOString()),{data:g}=x(n,r.toISOString(),c.toISOString()),{data:w}=S(n,r.toISOString(),c.toISOString());return(0,C.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,C.jsxs)(`div`,{children:[(0,C.jsx)(`h1`,{className:`text-3xl font-bold`,children:`User Analytics`}),(0,C.jsx)(`p`,{className:`text-muted-foreground`,children:`Track user behaviour and engagement`})]}),(0,C.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-4`,children:[(0,C.jsx)(d,{title:`Active Users`,value:e,description:`Last 30 days`,icon:l}),(0,C.jsx)(d,{title:`Total Clicks`,value:g?.topClicks.reduce((e,t)=>e+t.clicks,0)??0,description:`Button and link clicks`,icon:p}),(0,C.jsx)(d,{title:`Page Views`,value:w?.topPages.reduce((e,t)=>e+t.count,0)??0,description:`Total page views`,icon:h})]}),(0,C.jsx)(u,{title:`Top Clicks`,columns:[{header:`Element`,accessorKey:`element`},{header:`Clicks`,accessorKey:`clicks`,cell:e=>e.toLocaleString()}],data:g?.topClicks||[]}),(0,C.jsx)(u,{title:`Top Page Views`,columns:[{header:`URL`,accessorKey:`url`,cell:e=>(0,C.jsxs)(`div`,{children:[e,(0,C.jsx)(o,{to:e,className:`text-muted-foreground hover:text-accent-foreground`,target:`_blank`,children:(0,C.jsx)(_,{className:`inline-block ml-2 h-4 w-4 align-text-bottom`})})]})},{header:`Views`,accessorKey:`count`,cell:e=>e.toLocaleString()}],data:w?.topPages||[]})]})},E=T;E.displayName=`UserAnalyticsDashboard`;var D=E;export{E as Component,D as default,w as handle};