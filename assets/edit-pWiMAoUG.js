import{n as e,t}from"./hooks-BVZKHwJG.js";import{K as n,T as r,Z as i,n as a,s as ee,t as o,w as te,x as ne,y as re}from"./index-De71N5Dy.js";import{t as s}from"./button-DPMtwoy8.js";import{a as ie,i as ae,n as oe,r as c,t as se}from"./select-BpqZ3j4F.js";import{t as ce}from"./plus-CkBlMRvf.js";import{t as le}from"./square-pen-lo6g0KNM.js";import{t as ue}from"./trash-2-CLVwMF63.js";import{t as l}from"./input-BU6q5fO9.js";import"./es2015-nRZsoKYs.js";import{t as u}from"./label-BYyMeIUc.js";import{a as d,n as de,o as f,t as p}from"./card-D2-K7jj_.js";import{t as m}from"./textarea-B-9O50He.js";var h=i(n());function g(e){let t=Object.entries(e).filter(([,e])=>e==null||e===``).map(([e])=>e);if(t.length>0)throw Error(`Missing required parameters: ${t.join(`, `)}`)}var _=i(r());function v(){let{quizId:n}=ne(),r=n?parseInt(n,10):null,i=ee(e=>e.courses.currentCourseId),v=re(),y=te(),[b,fe]=(0,h.useState)(``),[pe,me]=(0,h.useState)(``),[x,S]=(0,h.useState)(null),[C,w]=(0,h.useState)(null),[T,E]=(0,h.useState)(null),[D,O]=(0,h.useState)(!1),[k,A]=(0,h.useState)(!1),[j,M]=(0,h.useState)(!0),[N,P]=(0,h.useState)(``),[he,F]=(0,h.useState)(!1),[I,L]=(0,h.useState)(null),[R,z]=(0,h.useState)(``),[B,V]=(0,h.useState)(`multiple_choice`),[H,U]=(0,h.useState)(1),[W,G]=(0,h.useState)([``,``,``,``]),[K,q]=(0,h.useState)([0]),[J,Y]=(0,h.useState)(``),{data:X,isLoading:ge}=t({...o.quizzes.detail(i,r),errorMessage:`Failed to load quiz`,enabled:!!i&&!!r}),{data:Z=[],isLoading:_e}=t({...o.quizzes.questions(i,r),errorMessage:`Failed to load quiz questions`,fallbackValue:[],enabled:!!i&&!!r}),ve=ge||_e;X&&!b&&(fe(X.title),me(X.description||``),S(X.timeLimit),w(X.maxAttempts),E(X.passingScore),O(X.isTimed),A(X.shuffleQuestions),M(X.showCorrectAnswers),P(X.dueDate?new Date(X.dueDate).toISOString().slice(0,16):``));let Q=e({mutationFn:async()=>{g({courseId:i,quizId:r});let e=await a.PUT(`/api/v1/courses/{courseId}/quizzes/{quizId}`,{params:{path:{courseId:i,quizId:r}},body:{title:b,description:pe||null,timeLimit:x&&x>0?x:null,maxAttempts:C&&C>0?C:null,passingScore:T??null,isTimed:D,shuffleQuestions:k,showCorrectAnswers:j,dueDate:N||null}});if(e.error)throw Error(`Failed to update quiz`);return e.data},errorMessage:`Failed to update quiz`,showSuccessToast:!0,successMessage:`Quiz updated successfully`,onSuccess:()=>{y.invalidateQueries({queryKey:o.quizzes.detail(i,r).queryKey}),v(`/courses/${i}/quizzes/${r}`)}}),ye=()=>{if(!R.trim()){Y(`Question text is required`);return}if(B===`multiple_choice`&&W.filter(e=>e.trim()).length<2){Y(`At least 2 options are required for multiple choice questions`);return}Y(``),be.mutate()},be=e({mutationFn:async()=>{g({courseId:i,quizId:r});let e=await a.POST(`/api/v1/courses/{courseId}/quizzes/{quizId}/questions`,{params:{path:{courseId:i,quizId:r}},body:{questionText:R,questionType:B,points:H,order:Z.length,options:B===`multiple_choice`?W.filter(e=>e):null,correctAnswer:B===`multiple_choice`?K:null}});if(e.error)throw Error(`Failed to add question`);return e.data},errorMessage:`Failed to add question`,showSuccessToast:!0,successMessage:`Question added successfully`,onSuccess:()=>{y.invalidateQueries({queryKey:o.quizzes.questions(i,r).queryKey}),$()}}),xe=()=>{if(!R.trim()){Y(`Question text is required`);return}if(B===`multiple_choice`&&W.filter(e=>e.trim()).length<2){Y(`At least 2 options are required for multiple choice questions`);return}Y(``),Se.mutate()},Se=e({mutationFn:async()=>{g({courseId:i,quizId:r,editingQuestionId:I});let e=await a.PUT(`/api/v1/courses/{courseId}/quizzes/{quizId}/questions/{questionId}`,{params:{path:{courseId:i,quizId:r,questionId:I}},body:{questionText:R,questionType:B,points:H,order:Z.findIndex(e=>e.id===I),options:B===`multiple_choice`?W.filter(e=>e):null,correctAnswer:B===`multiple_choice`?K:null}});if(e.error)throw Error(`Failed to update question`);return e.data},errorMessage:`Failed to update question`,showSuccessToast:!0,successMessage:`Question updated successfully`,onSuccess:()=>{y.invalidateQueries({queryKey:o.quizzes.questions(i,r).queryKey}),$()}}),Ce=e=>{L(e.id),z(e.questionText),V(e.questionType),U(e.points),e.questionType===`multiple_choice`&&e.options&&(G([...e.options,``,``,``,``].slice(0,4)),Array.isArray(e.correctAnswer)?q(e.correctAnswer):typeof e.correctAnswer==`number`&&q([e.correctAnswer])),F(!0),Y(``)},$=()=>{F(!1),L(null),z(``),V(`multiple_choice`),U(1),G([``,``,``,``]),q([0]),Y(``)},we=e({mutationFn:async e=>{g({courseId:i,quizId:r});let t=await a.DELETE(`/api/v1/courses/{courseId}/quizzes/{quizId}/questions/{questionId}`,{params:{path:{courseId:i,quizId:r,questionId:e}}});if(t.error)throw Error(`Failed to delete question`);return t.data},errorMessage:`Failed to delete question`,showSuccessToast:!0,successMessage:`Question deleted successfully`,onSuccess:()=>{y.invalidateQueries({queryKey:o.quizzes.questions(i,r).queryKey})}}),Te=e=>{we.mutate(e)};return ve?(0,_.jsx)(`div`,{className:`max-w-5xl mx-auto px-6 pb-8 h-[calc(100vh-4rem)] overflow-y-auto`,children:(0,_.jsx)(`div`,{className:`flex items-center justify-center pt-8`,children:(0,_.jsx)(`p`,{className:`text-muted-foreground`,children:`Loading…`})})}):(0,_.jsxs)(`div`,{className:`max-w-5xl mx-auto px-6 pb-8 h-[calc(100vh-4rem)] overflow-y-auto`,children:[(0,_.jsxs)(`div`,{className:`sticky top-0 bg-background pt-8 pb-4 z-10`,children:[(0,_.jsx)(s,{variant:`ghost`,onClick:()=>v(`/courses/${i}/quizzes/${r}`),className:`mb-4`,children:`← Back to Quiz`}),(0,_.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Edit Quiz`})]}),(0,_.jsxs)(`div`,{className:`space-y-6`,children:[(0,_.jsxs)(p,{children:[(0,_.jsx)(d,{children:(0,_.jsx)(f,{children:`Quiz Details`})}),(0,_.jsxs)(de,{className:`space-y-4`,children:[(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`title`,children:`Title *`}),(0,_.jsx)(l,{id:`title`,value:b,onChange:e=>fe(e.target.value),required:!0})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`description`,children:`Description`}),(0,_.jsx)(m,{id:`description`,value:pe,onChange:e=>me(e.target.value),rows:4})]}),(0,_.jsxs)(`div`,{className:`grid grid-cols-2 gap-4`,children:[(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`timeLimit`,children:`Time Limit (minutes)`}),(0,_.jsx)(l,{id:`timeLimit`,type:`number`,min:`0`,value:x??``,onChange:e=>S(e.target.value?parseInt(e.target.value):null)})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`maxAttempts`,children:`Max Attempts`}),(0,_.jsx)(l,{id:`maxAttempts`,type:`number`,min:`0`,value:C??``,onChange:e=>w(e.target.value?parseInt(e.target.value):null)})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`passingScore`,children:`Passing Score (%)`}),(0,_.jsx)(l,{id:`passingScore`,type:`number`,min:`0`,max:`100`,value:T??``,onChange:e=>E(e.target.value?parseInt(e.target.value):null)})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`dueDate`,children:`Due Date`}),(0,_.jsx)(l,{id:`dueDate`,type:`datetime-local`,value:N,onChange:e=>P(e.target.value)})]})]}),(0,_.jsxs)(`div`,{className:`space-y-2`,children:[(0,_.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,_.jsx)(`input`,{type:`checkbox`,id:`isTimed`,checked:D,onChange:e=>O(e.target.checked),className:`h-4 w-4`}),(0,_.jsx)(u,{htmlFor:`isTimed`,className:`cursor-pointer`,children:`Enable time limit enforcement`})]}),(0,_.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,_.jsx)(`input`,{type:`checkbox`,id:`shuffleQuestions`,checked:k,onChange:e=>A(e.target.checked),className:`h-4 w-4`}),(0,_.jsx)(u,{htmlFor:`shuffleQuestions`,className:`cursor-pointer`,children:`Shuffle questions for each attempt`})]}),(0,_.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,_.jsx)(`input`,{type:`checkbox`,id:`showCorrectAnswers`,checked:j,onChange:e=>M(e.target.checked),className:`h-4 w-4`}),(0,_.jsx)(u,{htmlFor:`showCorrectAnswers`,className:`cursor-pointer`,children:`Show correct answers after submission`})]})]})]})]}),(0,_.jsxs)(p,{children:[(0,_.jsxs)(d,{className:`flex flex-row items-center justify-between`,children:[(0,_.jsxs)(f,{children:[`Questions (`,Z.length,`)`]}),(0,_.jsxs)(s,{onClick:()=>F(!0),size:`sm`,children:[(0,_.jsx)(ce,{className:`h-4 w-4 mr-2`}),`Add Question`]})]}),(0,_.jsxs)(de,{className:`space-y-4`,children:[Z.map((e,t)=>(0,_.jsx)(`div`,{className:`p-4 border rounded-lg`,children:(0,_.jsxs)(`div`,{className:`flex items-start justify-between`,children:[(0,_.jsxs)(`div`,{className:`flex-1`,children:[(0,_.jsxs)(`div`,{className:`flex items-center gap-2 mb-2`,children:[(0,_.jsxs)(`span`,{className:`font-semibold`,children:[`Question `,t+1]}),(0,_.jsxs)(`span`,{className:`text-sm text-muted-foreground`,children:[`(`,e.questionType===`multiple_choice`?`Multiple Choice`:`Short Answer`,`)`]}),(0,_.jsxs)(`span`,{className:`text-sm text-muted-foreground`,children:[e.points,` `,e.points===1?`point`:`points`]})]}),(0,_.jsx)(`p`,{className:`mb-2`,children:e.questionText}),e.options&&(0,_.jsx)(`ul`,{className:`list-disc list-inside text-sm text-muted-foreground`,children:e.options.map((e,t)=>(0,_.jsx)(`li`,{children:e},t))})]}),(0,_.jsxs)(`div`,{className:`flex gap-2`,children:[(0,_.jsx)(s,{variant:`ghost`,size:`sm`,onClick:()=>Ce(e),children:(0,_.jsx)(le,{className:`h-4 w-4`})}),(0,_.jsx)(s,{variant:`ghost`,size:`sm`,onClick:()=>Te(e.id),children:(0,_.jsx)(ue,{className:`h-4 w-4 text-destructive`})})]})]})},e.id)),he&&(0,_.jsxs)(`div`,{className:`p-4 border-2 border-dashed rounded-lg space-y-4`,children:[(0,_.jsx)(`h3`,{className:`font-semibold`,children:I?`Edit Question`:`New Question`}),J&&(0,_.jsx)(`div`,{className:`p-3 bg-red-50 border border-red-200 rounded-md text-red-800 text-sm`,children:J}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`newQuestionType`,children:`Question Type`}),(0,_.jsxs)(se,{value:B,onValueChange:e=>V(e),children:[(0,_.jsx)(ae,{children:(0,_.jsx)(ie,{})}),(0,_.jsxs)(oe,{children:[(0,_.jsx)(c,{value:`multiple_choice`,children:`Multiple Choice`}),(0,_.jsx)(c,{value:`short_answer`,children:`Short Answer`})]})]})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`newQuestionText`,children:`Question Text`}),(0,_.jsx)(m,{id:`newQuestionText`,value:R,onChange:e=>z(e.target.value),placeholder:`Enter your question`,rows:3})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(u,{htmlFor:`newQuestionPoints`,children:`Points`}),(0,_.jsx)(l,{id:`newQuestionPoints`,type:`number`,min:`0`,value:H,onChange:e=>U(parseInt(e.target.value))})]}),B===`multiple_choice`&&(0,_.jsxs)(`div`,{className:`space-y-2`,children:[(0,_.jsx)(u,{children:`Options`}),W.map((e,t)=>(0,_.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,_.jsx)(`input`,{type:`radio`,name:`correctAnswer`,checked:K.includes(t),onChange:()=>q([t]),className:`h-4 w-4`}),(0,_.jsx)(l,{value:e,onChange:e=>{let n=[...W];n[t]=e.target.value,G(n)},placeholder:`Option ${t+1}`})]},t))]}),(0,_.jsxs)(`div`,{className:`flex gap-2`,children:[(0,_.jsx)(s,{onClick:I?xe:ye,size:`sm`,children:I?`Update Question`:`Add Question`}),(0,_.jsx)(s,{variant:`outline`,size:`sm`,onClick:$,children:`Cancel`})]})]})]})]}),(0,_.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,_.jsx)(s,{variant:`outline`,onClick:()=>v(`/courses/${i}/quizzes/${r}`),disabled:Q.isPending,children:`Cancel`}),(0,_.jsx)(s,{onClick:()=>Q.mutate(),disabled:Q.isPending||!b,children:Q.isPending?(0,_.jsx)(_.Fragment,{children:`Saving…`}):`Save Changes`})]})]})]})}const y=v;export{y as Component};