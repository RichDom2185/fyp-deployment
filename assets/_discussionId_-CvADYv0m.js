import{K as e,M as t,O as n,b as r,d as i,f as a,m as o,r as s,u as c}from"./index-BhFOQNBT.js";import"./createLucideIcon-fTqSzsiU.js";import{b as l}from"./RichTextEditor-DU64Jr9a.js";import"./dist-BWP1BH0m.js";import{b as u,c as d,d as f}from"./card-OqURSol_.js";import"./dist-ztOuzjD-.js";import"./dist-D522ueSb.js";import{b as p}from"./button-D5Dzo2oi.js";import"./dist-nqO5qK0j.js";import"./dist-CCQcB0uV.js";import{b as m,c as h,d as g}from"./avatar-ioUUmTiV.js";import"./shim-0-BgrIWa.js";import"./dist-t_mG3zYn.js";import"./tooltip-LOK67Pjz.js";import{b as _}from"./RelativeTime-D9hJHkeR.js";import{b as v}from"./separator-D2MLSFpl.js";import{b as y}from"./RichTextViewer-lzGO4wEi.js";var b=n(e()),x=n(t()),S=n(c());function C(e){return new Date(e).toLocaleString()}const w=(({post:e,nesting:t=0,onReply:n})=>{let[r,i]=(0,x.useState)(!1),a=(0,x.useRef)(null);return(0,S.jsxs)(`div`,{style:{marginLeft:t*24,marginTop:16},children:[(0,S.jsxs)(u,{children:[(0,S.jsxs)(f,{className:`flex items-center gap-2`,children:[(0,S.jsxs)(m,{children:[(0,S.jsx)(g,{src:e.author.avatarUrl,alt:e.author.name}),(0,S.jsx)(h,{children:e.author.name.charAt(0)})]}),(0,S.jsx)(`span`,{className:`font-semibold`,children:e.author.name}),(0,S.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:C(e.createdAt)})]}),(0,S.jsxs)(d,{className:`space-y-4`,children:[(0,S.jsx)(y,{htmlContent:e.content}),r?(0,S.jsxs)(`div`,{children:[(0,S.jsx)(l,{ref:a}),(0,S.jsxs)(`div`,{className:`flex gap-2 mt-2`,children:[(0,S.jsx)(p,{size:`sm`,onClick:()=>{let t=a.current?.getHtmlContent();t&&(n(e.id,t),i(!1))},children:`Post Reply`}),(0,S.jsx)(p,{size:`sm`,variant:`ghost`,onClick:()=>i(!1),children:`Cancel`})]})]}):(0,S.jsx)(`div`,{children:(0,S.jsx)(p,{size:`sm`,variant:`outline`,onClick:()=>i(!0),children:`Reply`})})]})]}),e.replies?.map(e=>(0,S.jsx)(w,{post:e,nesting:t+1,onReply:n},e.id))]})});var T=w;const E={breadcrumb:e=>{let{discussionId:t}=e.params,n=i.getState().discussions.discussions.find(e=>e.id.toString()===t)?.title;return n?`Discussion: ${n}`:void 0}},D=(async({params:e})=>{let{discussionId:t}=e,n=await r.GET(`/api/v1/discussions/{discussionId}/posts`,{params:{path:{discussionId:Number(t)}}});return n.data}),O=async(e,t,n)=>await r.POST(`/api/v1/discussions/{discussionId}/reply`,{params:{path:{discussionId:Number(e)}},body:{content:t,parentId:n}}),k=()=>{let e=o(),t=(0,x.useRef)(null),[n,r]=(0,x.useState)(e.posts),{discussionId:i}=s(),c=a(e=>e.discussions.discussions.find(e=>e.id.toString()===i));if((0,x.useEffect)(()=>{r(e.posts)},[e.posts]),!c)return(0,S.jsx)(`div`,{children:`Discussion not found`});let u=(0,b.default)(c.createdAt),d=(0,b.default)(c.updatedAt),f=async()=>{let e=t.current?.getHtmlContent();if(!e)return;let a=await O(Number(i),e,null);a.data&&(r([...n,a.data]),t.current?.clearContent())},y=async(e,t)=>{let a=await O(Number(i),t,e);if(!a.data)return;let o=t=>t.map(t=>t.id===e?{...t,replies:t.replies?[...t.replies,a.data]:[a.data]}:t.replies?{...t,replies:o(t.replies)}:t);r(o(n))};return(0,S.jsxs)(`div`,{className:`max-w-3xl mx-auto py-8`,children:[(0,S.jsx)(`h1`,{className:`text-3xl font-bold mb-2`,children:c.title}),(0,S.jsx)(`p`,{className:`text-muted-foreground mb-4`,children:c.description}),(0,S.jsxs)(`div`,{className:`text-sm text-muted-foreground flex items-center gap-2 mb-4`,children:[(0,S.jsx)(`span`,{children:u.format(`lll`)}),(0,S.jsx)(`span`,{children:`Â·`}),(0,S.jsxs)(`span`,{children:[`Last updated `,(0,S.jsx)(_,{timestamp:d})]})]}),(0,S.jsx)(`div`,{className:`flex items-center gap-x-4 mb-4`,children:(0,S.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,S.jsxs)(m,{children:[(0,S.jsx)(g,{src:c.author.avatarUrl,alt:c.author.name}),(0,S.jsx)(h,{children:c.author.name.charAt(0)})]}),(0,S.jsx)(`span`,{className:`font-semibold`,children:c.author.name})]})}),(0,S.jsx)(v,{className:`mb-6`}),(0,S.jsx)(`div`,{className:`space-y-6`,children:n.map(e=>(0,S.jsx)(T,{post:e,onReply:y},e.id))}),n.length>0?(0,S.jsx)(v,{className:`my-8`}):(0,S.jsx)(`p`,{className:`text-muted-foreground my-8 text-center italic`,children:`Add your first post below!`}),(0,S.jsxs)(`div`,{children:[(0,S.jsx)(`h2`,{className:`text-xl font-semibold mb-2`,children:`Add a new post`}),(0,S.jsx)(l,{ref:t}),(0,S.jsx)(p,{className:`mt-2`,onClick:f,children:`Post`})]})]})},A=k;A.displayName=`DiscussionId`;var j=A;export{A as Component,j as default,E as handle,D as loader};