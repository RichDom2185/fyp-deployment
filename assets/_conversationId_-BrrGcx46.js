import{K as e,T as t,W as n,Z as r,g as i,n as a,x as o}from"./index-De71N5Dy.js";import{t as s}from"./utils-BVdesv7M.js";import{t as c}from"./button-DPMtwoy8.js";import{t as l}from"./createLucideIcon-UCLnlboM.js";import{t as u}from"./check-KSYZl4kN.js";import{a as d,i as f,n as p,r as m,t as h}from"./select-BpqZ3j4F.js";import{n as g,r as _,t as v}from"./sparkles-BN7VF6tK.js";import{t as y}from"./clock-CYmahE3n.js";import{t as b}from"./file-text-DrvPVyfm.js";import{t as x}from"./message-square-BnwfAhft.js";import{t as S}from"./settings-DBuiP57r.js";import{t as C}from"./trash-2-CLVwMF63.js";import{t as w}from"./x-BvgmIxFh.js";import{t as T}from"./separator-BrSnISek.js";import"./es2015-nRZsoKYs.js";import{i as E,o as D,r as ee,s as te,t as O}from"./dialog-BifXuZ_c.js";import{i as k,n as A,r as j,t as M}from"./tooltip-B1ArGQNb.js";import{t as N}from"./label-BYyMeIUc.js";import{n as P,r as F,t as I}from"./collapsible-DBMBjGgv.js";import{a as L,i as R,n as z,o as B,r as V,t as H}from"./card-D2-K7jj_.js";import{t as U}from"./scroll-area-RaNtGQ1I.js";import{t as W}from"./badge-BMO5XGh0.js";import{t as G}from"./textarea-B-9O50He.js";import{t as K}from"./RelativeTime-BJvf6Ij-.js";var q=l(`circle-alert`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`line`,{x1:`12`,x2:`12`,y1:`8`,y2:`12`,key:`1pkeuh`}],[`line`,{x1:`12`,x2:`12.01`,y1:`16`,y2:`16`,key:`4dfq90`}]]),ne=l(`code-xml`,[[`path`,{d:`m18 16 4-4-4-4`,key:`1inbqp`}],[`path`,{d:`m6 8-4 4 4 4`,key:`15zrgr`}],[`path`,{d:`m14.5 4-5 16`,key:`e7oirm`}]]),J=l(`send`,[[`path`,{d:`M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z`,key:`1ffxy3`}],[`path`,{d:`m21.854 2.147-10.94 10.939`,key:`12cjpa`}]]),Y=l(`triangle-alert`,[[`path`,{d:`m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3`,key:`wmoenq`}],[`path`,{d:`M12 9v4`,key:`juzpu7`}],[`path`,{d:`M12 17h.01`,key:`p32p05`}]]),X=r(e()),Z=r(t());function re({isSelected:e,onClick:t,leadingIcon:n,label:r,children:i}){return(0,Z.jsxs)(M,{children:[(0,Z.jsx)(k,{asChild:!0,children:(0,Z.jsxs)(c,{variant:e?`default`:`outline`,size:`sm`,onClick:t,className:s(`h-8 px-3`,e&&`bg-blue-600 hover:bg-blue-700`),children:[n&&(0,Z.jsx)(n,{className:`h-4 w-4 mr-1`}),r]})}),(0,Z.jsx)(A,{children:i})]})}var ie=re,ae=[{Icon:void 0,type:`all`,label:`All`,tooltip:`Search across all course content`},{Icon:x,type:`discussions`,label:`Discussions`,tooltip:`Only search discussion posts`},{Icon:b,type:`files`,label:`Files`,tooltip:`Only search course files and materials`}];function oe({selectedContext:e,onContextChange:t}){return(0,Z.jsx)(j,{children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 p-2 border-b`,children:[(0,Z.jsx)(`span`,{className:`text-sm text-gray-600 dark:text-gray-400`,children:`Context:`}),(0,Z.jsx)(`div`,{className:`flex gap-1`,children:ae.map(({Icon:n,type:r,label:i,tooltip:a})=>(0,Z.jsx)(ie,{isSelected:e===r,onClick:()=>t(r),leadingIcon:n,label:i,children:(0,Z.jsx)(`p`,{children:a})},r))})]})})}var se=(0,X.memo)(oe),Q=r(n());function ce({toolCall:e,onApprove:t,onDeny:n,isExecuting:r=!1}){let[i,a]=(0,X.useState)(`once`),[o,s]=(0,X.useState)(!1),l=async()=>{s(!0);try{await t(i)}finally{s(!1)}},_=e.toolDisplayName||e.toolName,b=Object.entries(e.parameters).map(([e,t])=>({key:e,value:typeof t==`object`?JSON.stringify(t):String(t)}));return(0,Z.jsxs)(H,{className:`border-blue-200 bg-blue-50 dark:bg-blue-950 dark:border-blue-800`,children:[(0,Z.jsxs)(L,{children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(v,{className:`h-5 w-5 text-blue-600 dark:text-blue-400`}),(0,Z.jsx)(B,{className:`text-lg`,children:`AI Tool Request`}),(0,Z.jsx)(W,{variant:`secondary`,className:`ml-auto`,children:_})]}),(0,Z.jsx)(V,{children:`The AI assistant wants to use a tool to help answer your question.`})]}),(0,Z.jsxs)(z,{className:`space-y-4`,children:[(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 text-sm font-medium`,children:[(0,Z.jsx)(g,{className:`h-4 w-4`}),`Tool Details`]}),(0,Z.jsxs)(`div`,{className:`bg-white dark:bg-gray-900 rounded-md p-3 space-y-2 text-sm`,children:[(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`span`,{className:`font-medium`,children:`Tool:`}),` `,_]}),(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`span`,{className:`font-medium`,children:`Action:`}),` This tool will be executed with the following parameters:`]})]})]}),b.length>0&&(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(`div`,{className:`text-sm font-medium`,children:`Parameters:`}),(0,Z.jsx)(`div`,{className:`bg-white dark:bg-gray-900 rounded-md p-3 space-y-1`,children:b.map((e,t)=>(0,Z.jsxs)(`div`,{className:`text-sm font-mono`,children:[(0,Z.jsxs)(`span`,{className:`text-blue-600 dark:text-blue-400`,children:[e.key,`:`]}),` `,(0,Z.jsx)(`span`,{className:`text-gray-700 dark:text-gray-300`,children:e.value.length>100?e.value.substring(0,100)+`...`:e.value})]},t))})]}),e.requiresPermission&&(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(N,{htmlFor:`permission-scope`,children:`Permission Duration`}),(0,Z.jsxs)(h,{value:i,onValueChange:e=>a(e),disabled:o||r,children:[(0,Z.jsx)(f,{id:`permission-scope`,children:(0,Z.jsx)(d,{})}),(0,Z.jsxs)(p,{children:[(0,Z.jsx)(m,{value:`once`,children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(y,{className:`h-4 w-4`}),(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`div`,{className:`font-medium`,children:`Just Once`}),(0,Z.jsx)(`div`,{className:`text-xs text-gray-500`,children:`Allow only this time`})]})]})}),(0,Z.jsx)(m,{value:`conversation`,children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(Y,{className:`h-4 w-4`}),(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`div`,{className:`font-medium`,children:`This Conversation`}),(0,Z.jsx)(`div`,{className:`text-xs text-gray-500`,children:`Allow for this chat only`})]})]})}),(0,Z.jsx)(m,{value:`always`,children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(g,{className:`h-4 w-4`}),(0,Z.jsxs)(`div`,{children:[(0,Z.jsx)(`div`,{className:`font-medium`,children:`Always`}),(0,Z.jsx)(`div`,{className:`text-xs text-gray-500`,children:`Remember my choice`})]})]})})]})]}),(0,Z.jsxs)(`div`,{className:`text-xs text-gray-600 dark:text-gray-400 mt-2`,children:[i===`once`&&`The tool will be executed once. You'll be asked again next time.`,i===`conversation`&&`The tool can be used freely in this conversation.`,i===`always`&&`The tool can be used anytime without asking. You can revoke this in settings.`]})]})]}),(0,Z.jsxs)(R,{className:`flex gap-2`,children:[(0,Z.jsx)(c,{onClick:l,disabled:o||r,className:`flex-1`,children:o||r?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(`div`,{className:`animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full`}),`Executing...`]}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(u,{className:`mr-2 h-4 w-4`}),`Approve & Execute`]})}),(0,Z.jsxs)(c,{onClick:n,variant:`outline`,disabled:o||r,className:`flex-1`,children:[(0,Z.jsx)(w,{className:`mr-2 h-4 w-4`}),`Deny`]})]})]})}var le=ce;function ue({toolResult:e}){let[t,n]=(0,X.useState)(!1);return(0,Z.jsxs)(H,{className:e.success?`border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800`:`border-red-200 bg-red-50 dark:bg-red-950 dark:border-red-800`,children:[(0,Z.jsx)(L,{children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-2`,children:[e.success?(0,Z.jsx)(_,{className:`h-5 w-5 text-green-600 dark:text-green-400`}):(0,Z.jsx)(q,{className:`h-5 w-5 text-red-600 dark:text-red-400`}),(0,Z.jsx)(B,{className:`text-lg`,children:e.success?`Tool Executed`:`Tool Execution Failed`}),(0,Z.jsx)(W,{variant:`outline`,className:`ml-auto`,children:e.toolName})]})}),(0,Z.jsx)(z,{className:`space-y-3`,children:e.success?(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(`p`,{className:`text-sm text-gray-700 dark:text-gray-300`,children:`The tool executed successfully. Here are the results:`}),typeof e.result==`string`||typeof e.result==`number`?(0,Z.jsx)(`div`,{className:`bg-white dark:bg-gray-900 rounded-md p-3`,children:(0,Z.jsx)(`p`,{className:`text-sm text-gray-700 dark:text-gray-300`,children:String(e.result)})}):(0,Z.jsxs)(I,{open:t,onOpenChange:n,children:[(0,Z.jsx)(F,{asChild:!0,children:(0,Z.jsx)(c,{variant:`outline`,size:`sm`,className:`w-full justify-between`,children:(0,Z.jsxs)(`span`,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(ne,{className:`h-4 w-4`}),t?`Hide`:`View`,` Detailed Results`]})})}),(0,Z.jsx)(P,{className:`mt-2`,children:(0,Z.jsx)(`div`,{className:`bg-white dark:bg-gray-900 rounded-md p-3 overflow-x-auto`,children:(0,Z.jsx)(`pre`,{className:`text-xs font-mono text-gray-800 dark:text-gray-200`,children:(e=>e==null?`null`:typeof e==`string`?e:JSON.stringify(e,null,2))(e.result)})})})]})]}):(0,Z.jsxs)(`div`,{className:`space-y-2`,children:[(0,Z.jsx)(`p`,{className:`text-sm text-red-700 dark:text-red-300`,children:`The tool encountered an error during execution:`}),(0,Z.jsx)(`div`,{className:`bg-white dark:bg-gray-900 rounded-md p-3`,children:(0,Z.jsx)(`p`,{className:`text-sm font-mono text-red-600 dark:text-red-400`,children:e.error||`Unknown error`})})]})})]})}var de=ue;function fe({message:e,onToolApprove:t,onToolDeny:n,isExecutingTool:r=!1}){let i=e.role===`user`;return e.toolCall&&!e.toolResult&&!i?(0,Z.jsx)(`div`,{className:`flex w-full mb-4 justify-start`,children:(0,Z.jsxs)(`div`,{className:`max-w-[85%]`,children:[e.content&&(0,Z.jsx)(`div`,{className:`bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg px-4 py-3 mb-2`,children:(0,Z.jsx)(`div`,{className:`text-sm whitespace-pre-wrap wrap-break-word`,children:e.content})}),(0,Z.jsx)(le,{toolCall:e.toolCall,onApprove:n=>t?t(e.id,n):Promise.resolve(),onDeny:()=>n&&n(e.id),isExecuting:r})]})}):e.toolResult&&!i?(0,Z.jsx)(`div`,{className:`flex w-full mb-4 justify-start`,children:(0,Z.jsxs)(`div`,{className:`max-w-[85%]`,children:[(0,Z.jsx)(de,{toolResult:e.toolResult}),e.content&&(0,Z.jsxs)(`div`,{className:`bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg px-4 py-3 mt-2`,children:[(0,Z.jsx)(`div`,{className:`text-sm whitespace-pre-wrap wrap-break-word`,children:e.content}),(0,Z.jsx)(`div`,{className:`text-xs mt-1 text-gray-500 dark:text-gray-400`,children:(0,Z.jsx)(K,{className:`no-underline`,side:`right`,timestamp:(0,Q.default)(e.createdAt)})})]})]})}):(0,Z.jsx)(`div`,{className:s(`flex w-full mb-4`,i?`justify-end`:`justify-start`),children:(0,Z.jsxs)(`div`,{className:s(`max-w-[70%] rounded-lg px-4 py-3`,i?`bg-blue-600 text-white`:`bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100`),children:[(0,Z.jsx)(`div`,{className:`text-sm whitespace-pre-wrap wrap-break-word`,children:e.content}),(0,Z.jsx)(`div`,{className:s(`text-xs mt-1`,i?`text-blue-100`:`text-gray-500 dark:text-gray-400`),children:(0,Z.jsx)(K,{className:`no-underline`,side:`right`,timestamp:(0,Q.default)(e.createdAt)})})]})})}var pe=(0,X.memo)(fe);function $({open:e,onOpenChange:t,conversationId:n}){let[r,i]=(0,X.useState)([]),[o,s]=(0,X.useState)(null),[l,u]=(0,X.useState)(!1);(0,X.useEffect)(()=>{e&&(d(),f())},[e,n]);let d=async()=>{u(!0);try{let e=await a.GET(`/api/v1/tool-permissions`,{params:{query:n?{conversationId:n}:void 0}});e.data&&i(e.data.map(e=>({...e,lastUsedAt:e.lastUsedAt?new Date(e.lastUsedAt):null,createdAt:new Date(e.createdAt)})))}catch(e){console.error(`Failed to load permissions:`,e)}finally{u(!1)}},f=async()=>{try{let e=await a.GET(`/api/v1/tool-permissions/stats`);e.data&&s(e.data)}catch(e){console.error(`Failed to load stats:`,e)}},p=async(e,t,n)=>{if(confirm(`Are you sure you want to revoke this permission?`))try{await a.DELETE(`/api/v1/tool-permissions/{toolId}`,{params:{path:{toolId:e},query:{scope:t,...t===`conversation`&&n?{conversationId:n}:{}}}}),await d(),await f()}catch(e){console.error(`Failed to revoke permission:`,e),alert(`Failed to revoke permission`)}},m=e=>{switch(e){case`always`:return(0,Z.jsx)(g,{className:`h-4 w-4 text-green-600`});case`conversation`:return(0,Z.jsx)(S,{className:`h-4 w-4 text-yellow-600`});default:return null}},h=e=>{switch(e){case`always`:return(0,Z.jsx)(W,{variant:`default`,className:`bg-green-600`,children:`Always`});case`conversation`:return(0,Z.jsx)(W,{variant:`secondary`,children:`Conversation`});default:return(0,Z.jsx)(W,{variant:`outline`,children:`Once`})}},_=e=>e?new Date(e).toLocaleDateString():`Never`;return(0,Z.jsx)(O,{open:e,onOpenChange:t,children:(0,Z.jsxs)(ee,{className:`max-w-2xl max-h-[80vh]`,children:[(0,Z.jsxs)(D,{children:[(0,Z.jsxs)(te,{className:`flex items-center gap-2`,children:[(0,Z.jsx)(g,{className:`h-5 w-5`}),`Tool Permissions`]}),(0,Z.jsx)(E,{children:`Manage which AI tools can be used automatically in your conversations.`})]}),o&&(0,Z.jsxs)(`div`,{className:`grid grid-cols-4 gap-4 py-4`,children:[(0,Z.jsxs)(`div`,{className:`text-center`,children:[(0,Z.jsx)(`div`,{className:`text-2xl font-bold`,children:o.totalPermissions}),(0,Z.jsx)(`div`,{className:`text-xs text-gray-500`,children:`Total`})]}),(0,Z.jsxs)(`div`,{className:`text-center`,children:[(0,Z.jsx)(`div`,{className:`text-2xl font-bold text-green-600`,children:o.alwaysPermissions}),(0,Z.jsx)(`div`,{className:`text-xs text-gray-500`,children:`Always`})]}),(0,Z.jsxs)(`div`,{className:`text-center`,children:[(0,Z.jsx)(`div`,{className:`text-2xl font-bold text-yellow-600`,children:o.conversationPermissions}),(0,Z.jsx)(`div`,{className:`text-xs text-gray-500`,children:`Conversation`})]}),(0,Z.jsxs)(`div`,{className:`text-center`,children:[(0,Z.jsx)(`div`,{className:`text-2xl font-bold text-blue-600`,children:o.totalUsage}),(0,Z.jsx)(`div`,{className:`text-xs text-gray-500`,children:`Uses`})]})]}),(0,Z.jsx)(T,{}),(0,Z.jsx)(U,{className:`h-[400px] pr-4`,children:l?(0,Z.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-500`,children:`Loading permissions...`}):r.length===0?(0,Z.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-500`,children:(0,Z.jsxs)(`div`,{className:`text-center`,children:[(0,Z.jsx)(`p`,{className:`text-lg mb-2`,children:`No permissions granted yet`}),(0,Z.jsx)(`p`,{className:`text-sm`,children:`Tool permissions will appear here when you approve AI tool usage.`})]})}):(0,Z.jsx)(`div`,{className:`space-y-3`,children:r.map(e=>(0,Z.jsxs)(`div`,{className:`flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800`,children:[(0,Z.jsxs)(`div`,{className:`flex-1`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 mb-1`,children:[m(e.scope),(0,Z.jsx)(`span`,{className:`font-medium`,children:e.toolDisplayName}),h(e.scope)]}),(0,Z.jsxs)(`div`,{className:`text-sm text-gray-500`,children:[(0,Z.jsx)(`span`,{className:`font-mono text-xs`,children:e.toolName}),` • `,`Used `,e.usageCount,` time`,e.usageCount===1?``:`s`,e.lastUsedAt&&(0,Z.jsxs)(Z.Fragment,{children:[` • `,`Last used: `,_(e.lastUsedAt)]})]})]}),(0,Z.jsx)(c,{variant:`ghost`,size:`sm`,onClick:()=>p(e.toolId,e.scope,e.conversationId),children:(0,Z.jsx)(C,{className:`h-4 w-4 text-red-500`})})]},e.id))})}),(0,Z.jsx)(`div`,{className:`flex justify-end gap-2 pt-4 border-t`,children:(0,Z.jsx)(c,{variant:`outline`,onClick:()=>t(!1),children:`Close`})})]})})}var me=$;function he({messages:e,conversationId:t,onSendMessage:n,onToolApprove:r,onToolDeny:i,isLoading:a=!1,executingToolMessageId:o=null}){let[s,l]=(0,X.useState)(``),[u,d]=(0,X.useState)(`all`),[f,p]=(0,X.useState)(!1),m=(0,X.useRef)(null),h=()=>{m.current?.scrollIntoView({behavior:`smooth`})};(0,X.useEffect)(()=>{h()},[e]);let g=async e=>{if(e.preventDefault(),!s.trim()||a)return;let t=s.trim();l(``),console.log(`Selected context:`,u),await n(t)};return(0,Z.jsxs)(`div`,{className:`flex flex-col h-full`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between border-b`,children:[(0,Z.jsx)(se,{selectedContext:u,onContextChange:d}),(0,Z.jsx)(c,{variant:`ghost`,size:`sm`,onClick:()=>p(!0),className:`m-2`,title:`Manage tool permissions`,children:(0,Z.jsx)(S,{className:`h-4 w-4`})})]}),(0,Z.jsxs)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:[e.length===0?(0,Z.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-500`,children:(0,Z.jsxs)(`div`,{className:`text-center`,children:[(0,Z.jsx)(`p`,{className:`text-lg mb-2`,children:`Start a conversation`}),(0,Z.jsxs)(`p`,{className:`text-sm`,children:[`Ask me anything about the`,` `,u===`all`?`course`:u===`discussions`?`course discussions`:`course files`,`!`]})]})}):(0,Z.jsxs)(Z.Fragment,{children:[e.map(e=>(0,Z.jsx)(pe,{message:e,onToolApprove:r,onToolDeny:i,isExecutingTool:o===e.id},e.id)),(0,Z.jsx)(`div`,{ref:m})]}),a&&(0,Z.jsx)(`div`,{className:`flex justify-start mb-4`,children:(0,Z.jsx)(`div`,{className:`bg-gray-200 dark:bg-gray-700 rounded-lg px-4 py-3`,children:(0,Z.jsxs)(`div`,{className:`flex gap-1`,children:[(0,Z.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce`}),(0,Z.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce`,style:{animationDelay:`0.1s`}}),(0,Z.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400  rounded-full animate-bounce`,style:{animationDelay:`0.2s`}})]})})})]}),(0,Z.jsx)(`div`,{className:`border-t p-4`,children:(0,Z.jsxs)(`form`,{onSubmit:g,className:`flex gap-2`,children:[(0,Z.jsx)(G,{value:s,onChange:e=>l(e.target.value),onKeyDown:e=>{e.key===`Enter`&&!e.shiftKey&&(e.preventDefault(),g(e))},placeholder:`Ask about course discussions...`,className:`resize-none`,disabled:a}),(0,Z.jsx)(c,{type:`submit`,size:`icon`,disabled:!s.trim()||a,className:`self-end`,children:(0,Z.jsx)(J,{})})]})}),(0,Z.jsx)(me,{open:f,onOpenChange:p,conversationId:t})]})}var ge=he;const _e={breadcrumb:e=>{let{conversation:t}=e.loaderData;return t?`Chat: ${t.title}`:`Loading...`}},ve=(async({params:e})=>{let t=e.conversationId;return await ye(Number(t))});var ye=async e=>{try{let t=await a.GET(`/api/v1/conversations/{conversationId}`,{params:{path:{conversationId:Number(e)}}});if(!t.data)return window.alert(`Something went wrong loading the conversation.`),{conversation:null,messages:null};let n=await a.GET(`/api/v1/conversations/{conversationId}/messages`,{params:{path:{conversationId:Number(e)}}});return{conversation:t.data,messages:n.data??null}}catch(e){return window.alert(`Failed to load conversation data: ${e instanceof Error?e.message:e}`),{conversation:null,messages:null}}};function be(){let e=i(),{conversationId:t}=o(),[n,r]=(0,X.useState)(e.messages?.messages??[]),[s,c]=(0,X.useState)(!1),[l,u]=(0,X.useState)(null);return(0,X.useEffect)(()=>{r(e.messages?.messages??[])},[e.messages]),(0,Z.jsx)(`div`,{className:`flex-1`,children:e.conversation?(0,Z.jsxs)(`div`,{className:`h-full flex flex-col`,children:[(0,Z.jsx)(`div`,{className:`hidden md:block border-b p-4`,children:(0,Z.jsx)(`h2`,{className:`text-lg font-semibold`,children:e.conversation.title})}),(0,Z.jsx)(`div`,{className:`flex-1 min-h-0`,children:(0,Z.jsx)(ge,{messages:n,conversationId:Number(t),onSendMessage:async e=>{if(t){c(!0);try{let i=await a.POST(`/api/v1/conversations/{conversationId}/messages`,{params:{path:{conversationId:Number(t)}},body:{content:e}});i.data&&r([...n,i.data.userMessage,i.data.assistantMessage])}catch(e){console.error(`Failed to send message:`,e),alert(`Failed to send message`)}finally{c(!1)}}},onToolApprove:async(e,i)=>{if(t){u(e);try{let o=await a.POST(`/api/v1/conversations/{conversationId}/messages/{messageId}/execute-tool`,{params:{path:{conversationId:Number(t),messageId:e}},body:{messageId:e,permissionScope:i}});if(o.data){let i=n.map(t=>t.id===e?o.data.updatedMessage:t);if(o.data.success){let e=`I've executed the tool successfully. ${typeof o.data.result==`string`?o.data.result:`The results are shown above.`}`,n={id:Date.now()+Math.random(),conversationId:Number(t),role:`assistant`,content:e,createdAt:new Date().toISOString()};r([...i,n])}else r(i)}}catch(e){console.error(`Failed to execute tool:`,e)}finally{u(null)}}},onToolDeny:e=>{console.log(`Tool execution denied for message:`,e)},isLoading:s,executingToolMessageId:l})})]}):(0,Z.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-500`,children:(0,Z.jsx)(`p`,{children:`Loading conversation...`})})})}const xe=be;export{xe as Component,_e as handle,ve as loader};