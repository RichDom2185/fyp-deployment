import{n as e,t}from"./hooks-CYRrV7oD.js";import{C as n,K as r,W as i,n as a,s as ee,t as o,w as s,x as te,y as ne}from"./index-DkHy_0vr.js";import{a as re,i as ie,n as ae,r as oe,t as se}from"./select-zJHlb6nx.js";import{t as ce}from"./plus-C1Kf0VHO.js";import{t as le}from"./square-pen-Bvk2UZNB.js";import{t as ue}from"./trash-2-DuGAmwcG.js";import{i as c,n as l,r as u,t as d}from"./card-BBO2aCaD.js";import{t as f}from"./button-CVZMqZS2.js";import"./es2015-DqD72R9q.js";import{t as p}from"./input-D350uBQc.js";import{t as m}from"./textarea-DnKqqzBp.js";import{t as h}from"./label-DTAA1nE2.js";var g=r(i());function _(e){let t=Object.entries(e).filter(([,e])=>e==null||e===``).map(([e])=>e);if(t.length>0)throw Error(`Missing required parameters: ${t.join(`, `)}`)}var v=r(s());const y=()=>{let{quizId:r}=te(),i=r?parseInt(r,10):null,s=ee(e=>e.courses.currentCourseId),y=ne(),b=n(),[x,de]=(0,g.useState)(``),[fe,S]=(0,g.useState)(``),[C,pe]=(0,g.useState)(null),[w,T]=(0,g.useState)(null),[E,D]=(0,g.useState)(null),[O,k]=(0,g.useState)(!1),[A,j]=(0,g.useState)(!1),[M,N]=(0,g.useState)(!0),[P,F]=(0,g.useState)(``),[me,I]=(0,g.useState)(!1),[L,R]=(0,g.useState)(null),[z,B]=(0,g.useState)(``),[V,H]=(0,g.useState)(`multiple_choice`),[U,W]=(0,g.useState)(1),[G,K]=(0,g.useState)([``,``,``,``]),[q,J]=(0,g.useState)([0]),[he,Y]=(0,g.useState)(``),{data:X,isLoading:ge}=t({...o.quizzes.detail(s,i),errorMessage:`Failed to load quiz`,enabled:!!s&&!!i}),{data:Z=[],isLoading:_e}=t({...o.quizzes.questions(s,i),errorMessage:`Failed to load quiz questions`,fallbackValue:[],enabled:!!s&&!!i}),ve=ge||_e;X&&!x&&(de(X.title),S(X.description||``),pe(X.timeLimit),T(X.maxAttempts),D(X.passingScore),k(X.isTimed),j(X.shuffleQuestions),N(X.showCorrectAnswers),F(X.dueDate?new Date(X.dueDate).toISOString().slice(0,16):``));let Q=e({mutationFn:async()=>{_({courseId:s,quizId:i});let e=await a.PUT(`/api/v1/courses/{courseId}/quizzes/{quizId}`,{params:{path:{courseId:s,quizId:i}},body:{title:x,description:fe||null,timeLimit:C&&C>0?C:null,maxAttempts:w&&w>0?w:null,passingScore:E??null,isTimed:O,shuffleQuestions:A,showCorrectAnswers:M,dueDate:P||null}});if(e.error)throw Error(`Failed to update quiz`);return e.data},errorMessage:`Failed to update quiz`,showSuccessToast:!0,successMessage:`Quiz updated successfully`,onSuccess:()=>{b.invalidateQueries({queryKey:o.quizzes.detail(s,i).queryKey}),y(`/courses/${s}/quizzes/${i}`)}}),ye=()=>{if(!z.trim()){Y(`Question text is required`);return}if(V===`multiple_choice`&&G.filter(e=>e.trim()).length<2){Y(`At least 2 options are required for multiple choice questions`);return}Y(``),be.mutate()},be=e({mutationFn:async()=>{_({courseId:s,quizId:i});let e=await a.POST(`/api/v1/courses/{courseId}/quizzes/{quizId}/questions`,{params:{path:{courseId:s,quizId:i}},body:{questionText:z,questionType:V,points:U,order:Z.length,options:V===`multiple_choice`?G.filter(e=>e):null,correctAnswer:V===`multiple_choice`?q:null}});if(e.error)throw Error(`Failed to add question`);return e.data},errorMessage:`Failed to add question`,showSuccessToast:!0,successMessage:`Question added successfully`,onSuccess:()=>{b.invalidateQueries({queryKey:o.quizzes.questions(s,i).queryKey}),$()}}),xe=()=>{if(!z.trim()){Y(`Question text is required`);return}if(V===`multiple_choice`&&G.filter(e=>e.trim()).length<2){Y(`At least 2 options are required for multiple choice questions`);return}Y(``),Se.mutate()},Se=e({mutationFn:async()=>{_({courseId:s,quizId:i,editingQuestionId:L});let e=await a.PUT(`/api/v1/courses/{courseId}/quizzes/{quizId}/questions/{questionId}`,{params:{path:{courseId:s,quizId:i,questionId:L}},body:{questionText:z,questionType:V,points:U,order:Z.findIndex(e=>e.id===L),options:V===`multiple_choice`?G.filter(e=>e):null,correctAnswer:V===`multiple_choice`?q:null}});if(e.error)throw Error(`Failed to update question`);return e.data},errorMessage:`Failed to update question`,showSuccessToast:!0,successMessage:`Question updated successfully`,onSuccess:()=>{b.invalidateQueries({queryKey:o.quizzes.questions(s,i).queryKey}),$()}}),Ce=e=>{R(e.id),B(e.questionText),H(e.questionType),W(e.points),e.questionType===`multiple_choice`&&e.options&&(K([...e.options,``,``,``,``].slice(0,4)),Array.isArray(e.correctAnswer)?J(e.correctAnswer):typeof e.correctAnswer==`number`&&J([e.correctAnswer])),I(!0),Y(``)},$=()=>{I(!1),R(null),B(``),H(`multiple_choice`),W(1),K([``,``,``,``]),J([0]),Y(``)},we=e({mutationFn:async e=>{_({courseId:s,quizId:i});let t=await a.DELETE(`/api/v1/courses/{courseId}/quizzes/{quizId}/questions/{questionId}`,{params:{path:{courseId:s,quizId:i,questionId:e}}});if(t.error)throw Error(`Failed to delete question`);return t.data},errorMessage:`Failed to delete question`,showSuccessToast:!0,successMessage:`Question deleted successfully`,onSuccess:()=>{b.invalidateQueries({queryKey:o.quizzes.questions(s,i).queryKey})}}),Te=e=>{we.mutate(e)};return ve?(0,v.jsx)(`div`,{className:`max-w-5xl mx-auto px-6 pb-8 h-[calc(100vh-4rem)] overflow-y-auto`,children:(0,v.jsx)(`div`,{className:`flex items-center justify-center pt-8`,children:(0,v.jsx)(`p`,{className:`text-muted-foreground`,children:`Loading…`})})}):(0,v.jsxs)(`div`,{className:`max-w-5xl mx-auto px-6 pb-8 h-[calc(100vh-4rem)] overflow-y-auto`,children:[(0,v.jsxs)(`div`,{className:`sticky top-0 bg-background pt-8 pb-4 z-10`,children:[(0,v.jsx)(f,{variant:`ghost`,onClick:()=>y(`/courses/${s}/quizzes/${i}`),className:`mb-4`,children:`← Back to Quiz`}),(0,v.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Edit Quiz`})]}),(0,v.jsxs)(`div`,{className:`space-y-6`,children:[(0,v.jsxs)(d,{children:[(0,v.jsx)(u,{children:(0,v.jsx)(c,{children:`Quiz Details`})}),(0,v.jsxs)(l,{className:`space-y-4`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`title`,children:`Title *`}),(0,v.jsx)(p,{id:`title`,value:x,onChange:e=>de(e.target.value),required:!0})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`description`,children:`Description`}),(0,v.jsx)(m,{id:`description`,value:fe,onChange:e=>S(e.target.value),rows:4})]}),(0,v.jsxs)(`div`,{className:`grid grid-cols-2 gap-4`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`timeLimit`,children:`Time Limit (minutes)`}),(0,v.jsx)(p,{id:`timeLimit`,type:`number`,min:`0`,value:C??``,onChange:e=>pe(e.target.value?parseInt(e.target.value):null)})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`maxAttempts`,children:`Max Attempts`}),(0,v.jsx)(p,{id:`maxAttempts`,type:`number`,min:`0`,value:w??``,onChange:e=>T(e.target.value?parseInt(e.target.value):null)})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`passingScore`,children:`Passing Score (%)`}),(0,v.jsx)(p,{id:`passingScore`,type:`number`,min:`0`,max:`100`,value:E??``,onChange:e=>D(e.target.value?parseInt(e.target.value):null)})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`dueDate`,children:`Due Date`}),(0,v.jsx)(p,{id:`dueDate`,type:`datetime-local`,value:P,onChange:e=>F(e.target.value)})]})]}),(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,v.jsx)(`input`,{type:`checkbox`,id:`isTimed`,checked:O,onChange:e=>k(e.target.checked),className:`h-4 w-4`}),(0,v.jsx)(h,{htmlFor:`isTimed`,className:`cursor-pointer`,children:`Enable time limit enforcement`})]}),(0,v.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,v.jsx)(`input`,{type:`checkbox`,id:`shuffleQuestions`,checked:A,onChange:e=>j(e.target.checked),className:`h-4 w-4`}),(0,v.jsx)(h,{htmlFor:`shuffleQuestions`,className:`cursor-pointer`,children:`Shuffle questions for each attempt`})]}),(0,v.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,v.jsx)(`input`,{type:`checkbox`,id:`showCorrectAnswers`,checked:M,onChange:e=>N(e.target.checked),className:`h-4 w-4`}),(0,v.jsx)(h,{htmlFor:`showCorrectAnswers`,className:`cursor-pointer`,children:`Show correct answers after submission`})]})]})]})]}),(0,v.jsxs)(d,{children:[(0,v.jsxs)(u,{className:`flex flex-row items-center justify-between`,children:[(0,v.jsxs)(c,{children:[`Questions (`,Z.length,`)`]}),(0,v.jsxs)(f,{onClick:()=>I(!0),size:`sm`,children:[(0,v.jsx)(ce,{className:`h-4 w-4 mr-2`}),`Add Question`]})]}),(0,v.jsxs)(l,{className:`space-y-4`,children:[Z.map((e,t)=>(0,v.jsx)(`div`,{className:`p-4 border rounded-lg`,children:(0,v.jsxs)(`div`,{className:`flex items-start justify-between`,children:[(0,v.jsxs)(`div`,{className:`flex-1`,children:[(0,v.jsxs)(`div`,{className:`flex items-center gap-2 mb-2`,children:[(0,v.jsxs)(`span`,{className:`font-semibold`,children:[`Question `,t+1]}),(0,v.jsxs)(`span`,{className:`text-sm text-muted-foreground`,children:[`(`,e.questionType===`multiple_choice`?`Multiple Choice`:`Short Answer`,`)`]}),(0,v.jsxs)(`span`,{className:`text-sm text-muted-foreground`,children:[e.points,` `,e.points===1?`point`:`points`]})]}),(0,v.jsx)(`p`,{className:`mb-2`,children:e.questionText}),e.options&&(0,v.jsx)(`ul`,{className:`list-disc list-inside text-sm text-muted-foreground`,children:e.options.map((e,t)=>(0,v.jsx)(`li`,{children:e},t))})]}),(0,v.jsxs)(`div`,{className:`flex gap-2`,children:[(0,v.jsx)(f,{variant:`ghost`,size:`sm`,onClick:()=>Ce(e),children:(0,v.jsx)(le,{className:`h-4 w-4`})}),(0,v.jsx)(f,{variant:`ghost`,size:`sm`,onClick:()=>Te(e.id),children:(0,v.jsx)(ue,{className:`h-4 w-4 text-destructive`})})]})]})},e.id)),me&&(0,v.jsxs)(`div`,{className:`p-4 border-2 border-dashed rounded-lg space-y-4`,children:[(0,v.jsx)(`h3`,{className:`font-semibold`,children:L?`Edit Question`:`New Question`}),he&&(0,v.jsx)(`div`,{className:`p-3 bg-red-50 border border-red-200 rounded-md text-red-800 text-sm`,children:he}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`newQuestionType`,children:`Question Type`}),(0,v.jsxs)(se,{value:V,onValueChange:e=>H(e),children:[(0,v.jsx)(ie,{children:(0,v.jsx)(re,{})}),(0,v.jsxs)(ae,{children:[(0,v.jsx)(oe,{value:`multiple_choice`,children:`Multiple Choice`}),(0,v.jsx)(oe,{value:`short_answer`,children:`Short Answer`})]})]})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`newQuestionText`,children:`Question Text`}),(0,v.jsx)(m,{id:`newQuestionText`,value:z,onChange:e=>B(e.target.value),placeholder:`Enter your question`,rows:3})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(h,{htmlFor:`newQuestionPoints`,children:`Points`}),(0,v.jsx)(p,{id:`newQuestionPoints`,type:`number`,min:`0`,value:U,onChange:e=>W(parseInt(e.target.value))})]}),V===`multiple_choice`&&(0,v.jsxs)(`div`,{className:`space-y-2`,children:[(0,v.jsx)(h,{children:`Options`}),G.map((e,t)=>(0,v.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,v.jsx)(`input`,{type:`radio`,name:`correctAnswer`,checked:q.includes(t),onChange:()=>J([t]),className:`h-4 w-4`}),(0,v.jsx)(p,{value:e,onChange:e=>{let n=[...G];n[t]=e.target.value,K(n)},placeholder:`Option ${t+1}`})]},t))]}),(0,v.jsxs)(`div`,{className:`flex gap-2`,children:[(0,v.jsx)(f,{onClick:L?xe:ye,size:`sm`,children:L?`Update Question`:`Add Question`}),(0,v.jsx)(f,{variant:`outline`,size:`sm`,onClick:$,children:`Cancel`})]})]})]})]}),(0,v.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,v.jsx)(f,{variant:`outline`,onClick:()=>y(`/courses/${s}/quizzes/${i}`),disabled:Q.isPending,children:`Cancel`}),(0,v.jsx)(f,{onClick:()=>Q.mutate(),disabled:Q.isPending||!x,children:Q.isPending?(0,v.jsx)(v.Fragment,{children:`Saving…`}):`Save Changes`})]})]})]})};y.displayName=`EditQuiz`;var b=y;export{y as Component,b as default};