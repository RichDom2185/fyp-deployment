import{t as e}from"./hooks-BVZKHwJG.js";import{K as t,T as n,W as r,Z as i,f as a,n as o,s,t as c}from"./index-De71N5Dy.js";import{t as l}from"./createLucideIcon-UCLnlboM.js";import{t as u}from"./users-4BIL9Twu.js";import"./card-D2-K7jj_.js";import{n as d,t as f}from"./TableWidget-ezCFp5ps.js";import"./scroll-area-RaNtGQ1I.js";import"./table-rrTSX0KC.js";var p=l(`mouse-pointer`,[[`path`,{d:`M12.586 12.586 19 19`,key:`ea5xo7`}],[`path`,{d:`M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z`,key:`277e5u`}]]),m=l(`scan-eye`,[[`path`,{d:`M3 7V5a2 2 0 0 1 2-2h2`,key:`aa7l1z`}],[`path`,{d:`M17 3h2a2 2 0 0 1 2 2v2`,key:`4qcy5o`}],[`path`,{d:`M21 17v2a2 2 0 0 1-2 2h-2`,key:`6vwrx8`}],[`path`,{d:`M7 21H5a2 2 0 0 1-2-2v-2`,key:`ioqczr`}],[`circle`,{cx:`12`,cy:`12`,r:`1`,key:`41hilf`}],[`path`,{d:`M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0`,key:`11ak4c`}]]),h=l(`square-arrow-out-up-right`,[[`path`,{d:`M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6`,key:`y09zxi`}],[`path`,{d:`m21 3-9 9`,key:`mpx6sq`}],[`path`,{d:`M15 3h6v6`,key:`1q9fwt`}]]),g=i(r()),_=i(t());function v(t,n,r){let i=e({...c.analytics.user._ctx.activeUsersOverTime(t,n,r),errorMessage:`Failed to load active user analytics`,fallbackValue:{data:[],total:0}});return{isLoading:i.isLoading,data:i.data?.data||[]}}function y(t,n,r){return e({...c.analytics.user._ctx.clicks(t,n,r),errorMessage:`Failed to load click analytics`,fallbackValue:void 0})}function b(t,n,r){return e({...c.analytics.user._ctx.pageViews(t,n,r),errorMessage:`Failed to load page view analytics`,fallbackValue:void 0})}var x=i(n());const S={breadcrumb:`User Analytics`};function C(){let[e,t]=(0,_.useState)(0),n=s(e=>e.courses.currentCourseId),[r,i]=(0,_.useState)((0,g.default)().subtract(30,`day`)),[c,l]=(0,_.useState)((0,g.default)());(0,_.useEffect)(()=>{n&&(async()=>{try{let e=await o.GET(`/api/v1/analytics/user/active-users`,{params:{query:{courseId:n,startDate:r.toISOString(),endDate:c.toISOString()}}});e.data&&t(e.data.count)}catch(e){console.error(`Failed to fetch user analytics:`,e)}})()},[n,c,r]);let{data:S}=v(n,r.toISOString(),c.toISOString()),{data:C}=y(n,r.toISOString(),c.toISOString()),{data:w}=b(n,r.toISOString(),c.toISOString());return(0,x.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`h1`,{className:`text-3xl font-bold`,children:`User Analytics`}),(0,x.jsx)(`p`,{className:`text-muted-foreground`,children:`Track user behaviour and engagement`})]}),(0,x.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-4`,children:[(0,x.jsx)(d,{title:`Active Users`,value:e,description:`Last 30 days`,icon:u}),(0,x.jsx)(d,{title:`Total Clicks`,value:C?.topClicks.reduce((e,t)=>e+t.clicks,0)??0,description:`Button and link clicks`,icon:p}),(0,x.jsx)(d,{title:`Page Views`,value:w?.topPages.reduce((e,t)=>e+t.count,0)??0,description:`Total page views`,icon:m})]}),(0,x.jsx)(f,{title:`Top Clicks`,columns:[{header:`Element`,accessorKey:`element`},{header:`Clicks`,accessorKey:`clicks`,cell:e=>e.toLocaleString()}],data:C?.topClicks||[]}),(0,x.jsx)(f,{title:`Top Page Views`,columns:[{header:`URL`,accessorKey:`url`,cell:e=>(0,x.jsxs)(`div`,{children:[e,(0,x.jsx)(a,{to:e,className:`text-muted-foreground hover:text-accent-foreground`,target:`_blank`,children:(0,x.jsx)(h,{className:`inline-block ml-2 h-4 w-4 align-text-bottom`})})]})},{header:`Views`,accessorKey:`count`,cell:e=>e.toLocaleString()}],data:w?.topPages||[]})]})}const w=C;export{w as Component,S as handle};