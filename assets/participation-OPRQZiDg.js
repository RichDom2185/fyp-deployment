import{K as e,T as t,Z as n,s as r}from"./index-Ra2lGJdp.js";var i=n(e()),a=n(t());function o(e){try{let t=JSON.parse(atob(e.split(`.`)[1]));return t.sub?Number(t.sub):null}catch{return null}}function s({baseUrl:e,courseId:t,courseName:n,initialPath:s=`/`,className:c}){let l=(0,i.useRef)(null),[u,d]=(0,i.useState)(!1),f=r(e=>e.auth.accessToken),p=(0,i.useMemo)(()=>f?o(f):null,[f]);if(!e)return console.error(`TalkEmbed: No baseUrl provided and no default configured`),null;let m=(0,i.useCallback)(()=>{let r=l.current;!r?.contentWindow||!f||!p||(r.contentWindow.postMessage({type:`talk:init`,token:f,userId:Number(p),courseId:t,courseName:n},e),r.contentWindow.postMessage({type:`talk:navigate`,path:s},e))},[f,p,t,n,e,s]);return(0,i.useEffect)(()=>{let t=t=>{if(!t.origin.startsWith(new URL(e).origin))return;let n=t.data;if(!n?.type?.startsWith(`talk:`)){console.warn(`Received unknown message from chatroom iframe:`,n);return}switch(n.type){case`talk:ready`:d(!0),m();break;case`talk:room-created`:console.log(`Chatroom created: ${n.roomCode}`);break;case`talk:error`:console.error(`Chatroom error: ${n.error}`);break}};return window.addEventListener(`message`,t),()=>window.removeEventListener(`message`,t)},[e,m]),(0,i.useEffect)(()=>{if(!u||!f)return;let t=l.current;t?.contentWindow&&t.contentWindow.postMessage({type:`talk:token-refresh`,token:f},e)},[f,u,e]),(0,a.jsx)(`iframe`,{ref:l,src:e,className:c,style:{width:`100%`,height:`100%`,border:`none`,minHeight:`500px`},allow:`microphone`,sandbox:`allow-scripts allow-same-origin allow-forms allow-popups`,title:`Class Participation Chatroom`})}var c=s,l=void 0;function u(){let e=r(e=>e.courses.currentCourseId),t=r(e=>e.courses.coursesList).find(t=>t.id===e);return e?(0,a.jsx)(`div`,{className:`flex h-full flex-col`,children:(0,a.jsx)(c,{baseUrl:l,courseId:e,courseName:t?.name,initialPath:`/create`,className:`flex-1 rounded-lg border`})}):(0,a.jsx)(`div`,{className:`p-6`,children:`No course selected.`})}const d=u;export{d as Component};