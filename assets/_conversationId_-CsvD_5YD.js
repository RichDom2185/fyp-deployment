import{K as e,M as t,O as n,b as r,m as i,r as a,u as o}from"./index-Bs8aadkd.js";import{b as s}from"./createLucideIcon-DqG0DHeO.js";import{b as c}from"./file-text-CcD0WgH1.js";import{b as l}from"./message-square-tEoxeZPu.js";import{g as u}from"./dist-llZru0B9.js";import"./dist--YnhsTxm.js";import"./dist-CCRb2na5.js";import{b as d}from"./button-BZWKUvv8.js";import"./dist-Bla976vA.js";import"./dist-7EGWOJjd.js";import"./dist-TtmwqwDH.js";import{b as f}from"./textarea-DIM2Xx7D.js";import{b as p,c as m,d as h,e as g}from"./tooltip-BqmQXZaS.js";import{b as _}from"./RelativeTime-xxK1NooJ.js";const v=[[`path`,{d:`M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z`,key:`1ffxy3`}],[`path`,{d:`m21.854 2.147-10.94 10.939`,key:`12cjpa`}]],y=s(`send`,v);var b=n(t()),x=n(o());const S=(({isSelected:e,onClick:t,leadingIcon:n,label:r,children:i})=>(0,x.jsxs)(p,{children:[(0,x.jsx)(g,{asChild:!0,children:(0,x.jsxs)(d,{variant:e?`default`:`outline`,size:`sm`,onClick:t,className:u(`h-8 px-3`,e&&`bg-blue-600 hover:bg-blue-700`),children:[n&&(0,x.jsx)(n,{className:`h-4 w-4 mr-1`}),r]})}),(0,x.jsx)(m,{children:i})]}));var C=S;const w=[{Icon:void 0,type:`all`,label:`All`,tooltip:`Search across all course content`},{Icon:l,type:`discussions`,label:`Discussions`,tooltip:`Only search discussion posts`},{Icon:c,type:`files`,label:`Files`,tooltip:`Only search course files and materials`}],T=(({selectedContext:e,onContextChange:t})=>(0,x.jsx)(h,{children:(0,x.jsxs)(`div`,{className:`flex items-center gap-2 p-2 border-b`,children:[(0,x.jsx)(`span`,{className:`text-sm text-gray-600 dark:text-gray-400`,children:`Context:`}),(0,x.jsx)(`div`,{className:`flex gap-1`,children:w.map(({Icon:n,type:r,label:i,tooltip:a})=>(0,x.jsx)(C,{isSelected:e===r,onClick:()=>t(r),leadingIcon:n,label:i,children:(0,x.jsx)(`p`,{children:a})},r))})]})}));var E=(0,b.memo)(T),D=n(e());const O=(({message:e})=>{let t=e.role===`user`;return(0,x.jsx)(`div`,{className:u(`flex w-full mb-4`,t?`justify-end`:`justify-start`),children:(0,x.jsxs)(`div`,{className:u(`max-w-[70%] rounded-lg px-4 py-3`,t?`bg-blue-600 text-white`:`bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100`),children:[(0,x.jsx)(`div`,{className:`text-sm whitespace-pre-wrap wrap-break-word`,children:e.content}),(0,x.jsx)(`div`,{className:u(`text-xs mt-1`,t?`text-blue-100`:`text-gray-500 dark:text-gray-400`),children:(0,x.jsx)(_,{className:`no-underline`,side:`right`,timestamp:(0,D.default)(e.createdAt)})})]})})});var k=(0,b.memo)(O);const A=(({messages:e,onSendMessage:t,isLoading:n=!1})=>{let[r,i]=(0,b.useState)(``),[a,o]=(0,b.useState)(`all`),s=(0,b.useRef)(null),c=()=>{s.current?.scrollIntoView({behavior:`smooth`})};(0,b.useEffect)(()=>{c()},[e]);let l=async e=>{if(e.preventDefault(),!r.trim()||n)return;let o=r.trim();i(``),console.log(`Selected context:`,a),await t(o)},u=e=>{e.key===`Enter`&&!e.shiftKey&&(e.preventDefault(),l(e))};return(0,x.jsxs)(`div`,{className:`flex flex-col h-full`,children:[(0,x.jsx)(E,{selectedContext:a,onContextChange:o}),(0,x.jsxs)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:[e.length===0?(0,x.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-500`,children:(0,x.jsxs)(`div`,{className:`text-center`,children:[(0,x.jsx)(`p`,{className:`text-lg mb-2`,children:`Start a conversation`}),(0,x.jsxs)(`p`,{className:`text-sm`,children:[`Ask me anything about the`,` `,a===`all`?`course`:a===`discussions`?`course discussions`:`course files`,`!`]})]})}):(0,x.jsxs)(x.Fragment,{children:[e.map(e=>(0,x.jsx)(k,{message:e},e.id)),(0,x.jsx)(`div`,{ref:s})]}),n&&(0,x.jsx)(`div`,{className:`flex justify-start mb-4`,children:(0,x.jsx)(`div`,{className:`bg-gray-200 dark:bg-gray-700 rounded-lg px-4 py-3`,children:(0,x.jsxs)(`div`,{className:`flex gap-1`,children:[(0,x.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce`}),(0,x.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce`,style:{animationDelay:`0.1s`}}),(0,x.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400  rounded-full animate-bounce`,style:{animationDelay:`0.2s`}})]})})})]}),(0,x.jsx)(`div`,{className:`border-t p-4`,children:(0,x.jsxs)(`form`,{onSubmit:l,className:`flex gap-2`,children:[(0,x.jsx)(f,{value:r,onChange:e=>i(e.target.value),onKeyDown:u,placeholder:`Ask about course discussions...`,className:`resize-none`,disabled:n}),(0,x.jsx)(d,{type:`submit`,size:`icon`,disabled:!r.trim()||n,className:`self-end`,children:(0,x.jsx)(y,{})})]})})]})});var j=A;const M={breadcrumb:e=>{let{conversation:t}=e.loaderData;return t?`Chat: ${t.title}`:`Loading...`}},N=(async({params:e})=>{let t=e.conversationId;return await P(Number(t))}),P=async e=>{try{let t=await r.GET(`/api/v1/conversations/{conversationId}`,{params:{path:{conversationId:Number(e)}}});if(!t.data)return window.alert(`Something went wrong loading the conversation.`),{conversation:null,messages:null};let n=await r.GET(`/api/v1/conversations/{conversationId}/messages`,{params:{path:{conversationId:Number(e)}}});return{conversation:t.data,messages:n.data??null}}catch(e){return window.alert(`Failed to load conversation data: ${e instanceof Error?e.message:e}`),{conversation:null,messages:null}}},F=()=>{let e=i(),{conversationId:t}=a(),[n,o]=(0,b.useState)(e.messages?.messages??[]),[s,c]=(0,b.useState)(!1);(0,b.useEffect)(()=>{o(e.messages?.messages??[])},[e.messages]);let l=async e=>{if(t){c(!0);try{let i=await r.POST(`/api/v1/conversations/{conversationId}/messages`,{params:{path:{conversationId:Number(t)}},body:{content:e}});i.data&&o([...n,i.data.userMessage,i.data.assistantMessage])}catch(e){console.error(`Failed to send message:`,e),alert(`Failed to send message`)}finally{c(!1)}}};return(0,x.jsx)(`div`,{className:`flex-1`,children:e.conversation?(0,x.jsxs)(`div`,{className:`h-full flex flex-col`,children:[(0,x.jsx)(`div`,{className:`hidden md:block border-b p-4`,children:(0,x.jsx)(`h2`,{className:`text-lg font-semibold`,children:e.conversation.title})}),(0,x.jsx)(`div`,{className:`flex-1 min-h-0`,children:(0,x.jsx)(j,{messages:n,onSendMessage:l,isLoading:s})})]}):(0,x.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-500`,children:(0,x.jsx)(`p`,{children:`Loading conversation...`})})})},I=F;I.displayName=`ChatConversation`;var L=I;export{I as Component,L as default,M as handle,N as loader};