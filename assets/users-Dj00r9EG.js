import{n as e,t}from"./hooks-BAT23hyk.js";import{K as n,T as r,Z as i,n as a,t as o,w as s,x as c}from"./index-Ra2lGJdp.js";import{t as l}from"./utils-AMbbdZOx.js";import{t as u}from"./button-ZbUugITV.js";import{a as d,i as f,n as p,r as m,t as h}from"./select-B5CW39xL.js";import{t as g}from"./plus-DHQX-CAp.js";import{t as _}from"./trash-2-tH3XFeSR.js";import{t as v}from"./upload-D4bPqgsw.js";import{t as y}from"./input-DWGpcTdi.js";import"./es2015-B0iSd3k2.js";import{a as b,i as x,o as S,r as C,s as w,t as T}from"./dialog-ZgoMsabM.js";import"./shim-D_jmsJEB.js";import{n as E,r as D,t as O}from"./avatar-aNmJ1UI2.js";import{n as k,o as A,r as j,t as M}from"./dropdown-menu-CCR9MF3_.js";import{t as N}from"./label-qYupBdTo.js";import{a as P,n as F,o as I,r as L,t as R}from"./card-DzwWgtAJ.js";var z=i(n()),B=i(r());function V({open:e,onOpenChange:t,onAdd:n,roles:r,isLoading:i}){let[a,o]=(0,z.useState)(``),[s,c]=(0,z.useState)(``);return(0,B.jsx)(T,{open:e,onOpenChange:t,children:(0,B.jsxs)(C,{children:[(0,B.jsxs)(S,{children:[(0,B.jsx)(w,{children:`Add User`}),(0,B.jsx)(x,{children:`Add a new user to the course by email address.`})]}),(0,B.jsxs)(`div`,{className:`space-y-4`,children:[(0,B.jsxs)(`div`,{className:`space-y-2`,children:[(0,B.jsx)(N,{htmlFor:`email`,children:`Email`}),(0,B.jsx)(y,{id:`email`,type:`email`,placeholder:`user@example.com`,value:a,onChange:e=>o(e.target.value)})]}),(0,B.jsxs)(`div`,{className:`space-y-2`,children:[(0,B.jsx)(N,{htmlFor:`role`,children:`Role`}),(0,B.jsxs)(h,{value:s,onValueChange:c,children:[(0,B.jsx)(f,{id:`role`,children:(0,B.jsx)(d,{placeholder:`Select a role`})}),(0,B.jsx)(p,{children:r?.map(e=>(0,B.jsx)(m,{value:e.id.toString(),children:e.name},e.id))})]})]})]}),(0,B.jsxs)(b,{children:[(0,B.jsx)(u,{variant:`outline`,onClick:()=>{t(!1),o(``),c(``)},children:`Cancel`}),(0,B.jsx)(u,{onClick:async()=>{!a||!s||(await n(a,parseInt(s)),o(``),c(``))},disabled:i||!a||!s,children:i?`Adding...`:`Add User`})]})]})})}var H=V;function U({open:e,onOpenChange:t,onBatchAdd:n,roles:r,isLoading:i}){let[a,o]=(0,z.useState)(``),[s,c]=(0,z.useState)([]),[g,_]=(0,z.useState)(!1),y=e=>{let t=e.split(/[\n,]/),n=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;return t.map(e=>e.trim()).filter(e=>e&&n.test(e))},E=e=>{let t=new FileReader;t.onload=e=>{let t=e.target?.result;c(y(t))},t.readAsText(e)},D=e=>{e.preventDefault(),e.stopPropagation(),e.type===`dragenter`||e.type===`dragover`?_(!0):e.type===`dragleave`&&_(!1)};return(0,B.jsx)(T,{open:e,onOpenChange:t,children:(0,B.jsxs)(C,{className:`max-w-2xl`,children:[(0,B.jsxs)(S,{children:[(0,B.jsx)(w,{children:`Batch Add Users`}),(0,B.jsx)(x,{children:`Upload a CSV file or drag and drop to add multiple users at once. The file should contain one email per line.`})]}),(0,B.jsxs)(`div`,{className:`space-y-4`,children:[(0,B.jsxs)(`div`,{className:`space-y-2`,children:[(0,B.jsx)(N,{htmlFor:`batch-role`,children:`Role`}),(0,B.jsxs)(h,{value:a,onValueChange:o,children:[(0,B.jsx)(f,{id:`batch-role`,children:(0,B.jsx)(d,{placeholder:`Select a role for all users`})}),(0,B.jsx)(p,{children:r?.map(e=>(0,B.jsx)(m,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,B.jsxs)(`div`,{className:l(`border-2 border-dashed rounded-lg p-8 text-center`,g?`border-primary bg-primary/5`:`border-muted`),onDragEnter:D,onDragLeave:D,onDragOver:D,onDrop:e=>{e.preventDefault(),e.stopPropagation(),_(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&E(e.dataTransfer.files[0])},children:[(0,B.jsx)(v,{className:`mx-auto h-12 w-12 text-muted-foreground`}),(0,B.jsxs)(`div`,{className:`mt-4`,children:[(0,B.jsxs)(N,{htmlFor:`csv-upload`,className:`cursor-pointer`,children:[(0,B.jsx)(`span`,{className:`text-primary hover:underline`,children:`Click to upload`}),` or drag and drop`]}),(0,B.jsx)(`input`,{id:`csv-upload`,type:`file`,accept:`.csv,.txt`,className:`hidden`,onChange:e=>{e.target.files&&e.target.files[0]&&E(e.target.files[0])}})]}),(0,B.jsx)(`p`,{className:`text-sm text-muted-foreground mt-2`,children:`CSV or TXT file with one email per line`})]}),s.length>0&&(0,B.jsxs)(`div`,{className:`space-y-2`,children:[(0,B.jsxs)(N,{children:[`Parsed Emails (`,s.length,`)`]}),(0,B.jsx)(`div`,{className:`max-h-40 overflow-y-auto border rounded-md p-3 text-sm`,children:s.map((e,t)=>(0,B.jsx)(`div`,{className:`py-1`,children:e},t))})]})]}),(0,B.jsxs)(b,{children:[(0,B.jsx)(u,{variant:`outline`,onClick:()=>{t(!1),c([]),o(``)},children:`Cancel`}),(0,B.jsx)(u,{onClick:async()=>{!a||s.length===0||(await n(s.map(e=>({email:e,roleId:parseInt(a)}))),c([]),o(``))},disabled:i||!a||s.length===0,children:i?`Adding...`:`Add ${s.length} Users`})]})]})})}var W=U;function G({roles:e,currentRoleId:t,onChange:n}){return(0,B.jsxs)(M,{children:[(0,B.jsx)(A,{asChild:!0,children:(0,B.jsx)(u,{variant:`outline`,size:`sm`,children:e.find(e=>e.id===t)?.name??`Unknown`})}),(0,B.jsx)(k,{children:e.map(e=>(0,B.jsx)(j,{onClick:()=>n(e.id),children:e.name},e.id))})]})}var K=G;function q({users:e,roles:t,onRoleChange:n,onRemoveUser:r}){return(0,B.jsxs)(`table`,{className:`min-w-full text-sm`,children:[(0,B.jsx)(`thead`,{className:`bg-muted`,children:(0,B.jsxs)(`tr`,{children:[(0,B.jsx)(`th`,{className:`p-3 text-left font-semibold`,children:`User`}),(0,B.jsx)(`th`,{className:`p-3 text-left font-semibold`,children:`Email`}),(0,B.jsx)(`th`,{className:`p-3 text-left font-semibold`,children:`Role`}),(0,B.jsx)(`th`,{className:`p-3 text-left font-semibold`,children:`Actions`})]})}),(0,B.jsx)(`tbody`,{children:e.map(e=>(0,B.jsxs)(`tr`,{className:`border-t`,children:[(0,B.jsx)(`td`,{className:`p-3`,children:(0,B.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,B.jsxs)(O,{children:[(0,B.jsx)(D,{src:void 0,alt:e.userName}),(0,B.jsx)(E,{children:e.userName.charAt(0).toUpperCase()})]}),(0,B.jsx)(`span`,{children:e.userName})]})}),(0,B.jsx)(`td`,{className:`p-3`,children:e.userEmail}),(0,B.jsx)(`td`,{className:`p-3`,children:(0,B.jsx)(K,{currentRoleId:e.roleId,roles:t??[],onChange:t=>n(e.id,t)})}),(0,B.jsx)(`td`,{className:`p-3`,children:(0,B.jsx)(u,{variant:`ghost`,size:`icon`,className:`text-destructive`,onClick:()=>r(e.id),"aria-label":`Remove ${e.userName} from course`,title:`Remove ${e.userName} from course`,children:(0,B.jsx)(_,{className:`h-4 w-4`})})})]},e.id))})]})}var J=q;const Y={breadcrumb:`User Settings`};function X(){let{courseId:n}=c(),r=n?parseInt(n):null,i=s(),[l,_]=(0,z.useState)(!1),[b,x]=(0,z.useState)(!1),[S,C]=(0,z.useState)(``),[w,T]=(0,z.useState)(`all`),{data:E}=t({...o.roles.list(r),errorMessage:`Failed to load roles`,fallbackValue:[],enabled:!!r}),D=E?.map(e=>({id:e.id,name:e.name})),{data:O,isLoading:k}=t({...o.members.list(r,S,w===`all`?void 0:w),errorMessage:`Failed to load course members`,fallbackValue:[],enabled:!!r}),A=O?.map(e=>({id:e.id,userId:e.user.id,userName:e.user.fullName,userEmail:e.user.email,roleName:e.role.name,roleId:e.role.id,joinedAt:e.createdAt})),j=e({mutationFn:async e=>{let t=await a.POST(`/api/v1/courses/{courseId}/members`,{params:{path:{courseId:parseInt(n)}},body:{members:e}});if(t.error)throw Error(`Failed to add members`);return t.data},errorMessage:`Failed to add members`,showSuccessToast:!0,successMessage:`Members added successfully`,onSuccess:()=>{i.invalidateQueries({queryKey:o.members.list._def}),i.invalidateQueries({queryKey:o.roles.list._def}),_(!1),x(!1)}}),M=e({mutationFn:async({memberId:e,roleId:t})=>{let r=await a.PUT(`/api/v1/courses/{courseId}/members/{memberId}`,{params:{path:{courseId:parseInt(n),memberId:e}},body:{roleId:t}});if(r.error)throw Error(`Failed to update role`);return r.data},errorMessage:`Failed to update role`,showSuccessToast:!0,successMessage:`Role updated successfully`,onSuccess:()=>{i.invalidateQueries({queryKey:o.members.list._def}),i.invalidateQueries({queryKey:o.roles.list._def})}}),N=e({mutationFn:async e=>{if((await a.DELETE(`/api/v1/courses/{courseId}/members/{memberId}`,{params:{path:{courseId:parseInt(n),memberId:e}}})).error)throw Error(`Failed to remove member`)},errorMessage:`Failed to remove member`,showSuccessToast:!0,successMessage:`Member removed successfully`,onSuccess:()=>{i.invalidateQueries({queryKey:o.members.list._def}),i.invalidateQueries({queryKey:o.roles.list._def})}});return(0,B.jsxs)(`div`,{className:`space-y-6 px-12 py-10`,children:[(0,B.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,B.jsxs)(`div`,{children:[(0,B.jsx)(`h1`,{className:`text-3xl font-bold`,children:`Course Users`}),(0,B.jsx)(`p`,{className:`text-muted-foreground`,children:`Manage users and their roles in this course`})]}),(0,B.jsxs)(`div`,{className:`flex gap-2`,children:[(0,B.jsxs)(u,{onClick:()=>x(!0),variant:`outline`,children:[(0,B.jsx)(v,{className:`h-4 w-4`}),`Batch Add`]}),(0,B.jsxs)(u,{onClick:()=>_(!0),children:[(0,B.jsx)(g,{className:`h-4 w-4`}),`Add User`]})]})]}),(0,B.jsxs)(R,{children:[(0,B.jsxs)(P,{children:[(0,B.jsx)(I,{children:`Users`}),(0,B.jsx)(L,{children:`View and manage all users in this course`})]}),(0,B.jsxs)(F,{children:[(0,B.jsxs)(`div`,{className:`flex gap-4 mb-4`,children:[(0,B.jsx)(y,{placeholder:`Search by name or email...`,value:S,onChange:e=>C(e.target.value),className:`max-w-sm`}),(0,B.jsxs)(h,{value:w,onValueChange:T,children:[(0,B.jsx)(f,{className:`max-w-xs`,children:(0,B.jsx)(d,{placeholder:`Filter by role`})}),(0,B.jsxs)(p,{children:[(0,B.jsx)(m,{value:`all`,children:`All Roles`}),D?.map(e=>(0,B.jsx)(m,{value:e.id.toString(),children:e.name},e.id))]})]})]}),(0,B.jsx)(`div`,{className:`overflow-x-auto rounded border`,children:k?(0,B.jsx)(`div`,{className:`text-center py-8`,children:`Loading membersâ€¦`}):!A||A.length===0?(0,B.jsx)(`div`,{className:`text-center py-8 text-muted-foreground`,children:`No members found`}):(0,B.jsx)(J,{users:A,roles:D,onRoleChange:(e,t)=>{M.mutate({memberId:e,roleId:t})},onRemoveUser:e=>{window.confirm(`Are you sure you want to remove this user from the course?`)&&N.mutate(e)}})})]})]}),(0,B.jsx)(H,{open:l,onOpenChange:_,onAdd:async(e,t)=>{await j.mutateAsync([{email:e,roleId:t}])},roles:D,isLoading:j.isPending}),(0,B.jsx)(W,{open:b,onOpenChange:x,onBatchAdd:async e=>{await j.mutateAsync(e)},roles:D,isLoading:j.isPending})]})}const Z=X;export{Z as Component,Y as handle};