import{K as e,W as t,b as n,f as r,m as i,n as a,s as o,w as s,x as c,y as l}from"./index-DkHy_0vr.js";import{t as u}from"./chevrons-up-down-Vl6IALkd.js";import{t as d}from"./plus-C1Kf0VHO.js";import{t as f}from"./trash-2-DuGAmwcG.js";import{r as p}from"./dist-UfzXyJyC.js";import{t as m}from"./button-CVZMqZS2.js";import"./es2015-DqD72R9q.js";import{c as h,o as g,r as _,s as v,t as y}from"./dialog-DV4qlhuR.js";import{t as b}from"./input-D350uBQc.js";import{t as x}from"./label-DTAA1nE2.js";import{t as S}from"./separator-BzoXs7wx.js";var C=e(t()),w=e(s()),T=(({conversations:e,currentConversationId:t,onDelete:n})=>{let i=c().courseId;return(0,w.jsx)(`div`,{className:`space-y-2`,children:e.length===0?(0,w.jsx)(`p`,{className:`text-sm text-gray-500 text-center py-8`,children:`No conversations yet. Start a new chat!`}):e.map(e=>(0,w.jsxs)(r,{to:`/courses/${i}/chat/${e.id}`,className:p(`flex items-center gap-2 rounded-lg p-3 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors`,t===e.id&&`bg-gray-100 dark:bg-gray-800`),children:[(0,w.jsx)(`span`,{className:`flex-1 min-w-0`,children:(0,w.jsx)(`div`,{className:`text-sm font-medium truncate`,children:e.title})}),n&&(0,w.jsx)(m,{variant:`ghost`,size:`icon`,className:`h-8 w-8 shrink-0 cursor-pointer hover:text-red-600`,onClick:t=>{t.preventDefault(),n(e.id)},children:(0,w.jsx)(f,{className:`h-4 w-4`})})]},e.id))})}),E=(({isDialogOpen:e,hideTrigger:t=!1,setIsDialogOpen:n,handleCreateConversation:r})=>{let[i,a]=(0,C.useState)(``),[o,s]=(0,C.useState)(!1),c=async e=>{if(!e.trim()){window.alert(`Chat title cannot be empty`);return}s(!0);try{await r(e)}catch(e){console.error(`Failed to create conversation:`,e),window.alert(`Failed to create conversation`)}finally{s(!1)}};return(0,w.jsxs)(y,{open:e,onOpenChange:n,children:[!t&&(0,w.jsx)(h,{asChild:!0,children:(0,w.jsxs)(m,{className:`w-full`,children:[(0,w.jsx)(d,{className:`h-4 w-4 mr-2`}),`New Chat`]})}),(0,w.jsxs)(_,{children:[(0,w.jsx)(g,{children:(0,w.jsx)(v,{children:`Start a New Chat`})}),(0,w.jsxs)(`div`,{className:`space-y-4 pt-4`,children:[(0,w.jsxs)(`div`,{className:`space-y-2`,children:[(0,w.jsx)(x,{htmlFor:`title`,children:`Chat Title`}),(0,w.jsx)(b,{id:`title`,value:i,onChange:e=>a(e.target.value),placeholder:`e.g., Midterm Discussion Summary`,onKeyDown:e=>{e.key===`Enter`&&c(i)}})]}),(0,w.jsx)(m,{onClick:()=>c(i),disabled:!i.trim()||o,className:`w-full`,children:`Create Chat`})]})]})]})}),D=(({open:e,onOpenChange:t,title:n,trigger:r,children:i})=>(0,w.jsxs)(y,{open:e,onOpenChange:t,children:[(0,w.jsx)(h,{asChild:!0,children:r}),(0,w.jsxs)(_,{className:`sm:max-w-lg w-full`,children:[(0,w.jsx)(g,{children:(0,w.jsx)(v,{children:n})}),(0,w.jsx)(`div`,{children:i})]})]})),O={sm:0,md:1,lg:2,xl:3,xxl:4},k=[640,768,1024,1280,1536],A=e=>{let t=k.length-1;for(;t>=0&&!(e>=k[t]);t--);return t};const j=()=>{let[e,t]=(0,C.useState)(A(window.innerWidth));return(0,C.useEffect)(()=>{let e=()=>{window.requestAnimationFrame(()=>{t(A(window.innerWidth))})};return window.addEventListener(`resize`,e),window.addEventListener(`orientationchange`,e),()=>{window.removeEventListener(`resize`,e),window.removeEventListener(`orientationchange`,e)}},[]),(0,C.useMemo)(()=>Object.fromEntries(Object.keys(O).map((t,n)=>[t,n<=e])),[e])};var M=()=>{let e=c(),t=e.courseId,n=e.conversationId===void 0?void 0:Number(e.conversationId),r=o(e=>e.courses.currentCourseId),[s,f]=(0,C.useState)([]),p=l();(0,C.useEffect)(()=>{(async()=>{if(r)try{let e=await a.GET(`/api/v1/conversations`,{params:{query:{courseId:r}}});e.data&&f(e.data.conversations)}catch(e){console.error(`Failed to load conversations:`,e)}})()},[r]);let h=async e=>{if(!e.trim()||!r)return;let n=await a.POST(`/api/v1/conversations`,{body:{title:e.trim(),courseId:r}});n.data&&(f([...s,n.data]),v(!1),p(`/courses/${t}/chat/${n.data.id}`))},g=async e=>{if(confirm(`Are you sure you want to delete this conversation?`))try{await a.DELETE(`/api/v1/conversations/{conversationId}`,{params:{path:{conversationId:e}}}),f(s.filter(t=>t.id!==e)),e===n&&p(`/courses/${t}/chat`)}catch(e){console.error(`Failed to delete conversation:`,e),window.alert(`Failed to delete conversation`)}},[_,v]=(0,C.useState)(!1),[y,b]=(0,C.useState)(!1),{md:x}=j();(0,C.useEffect)(()=>{n!==void 0&&b(!1)},[n]);let O=()=>v(!0);return x?(0,w.jsxs)(`div`,{className:`flex h-[calc(100vh-4rem)]`,children:[(0,w.jsxs)(`div`,{className:`w-80 border-r flex flex-col`,children:[(0,w.jsx)(`div`,{className:`p-4 border-b`,children:(0,w.jsx)(E,{isDialogOpen:_,setIsDialogOpen:v,handleCreateConversation:h})}),(0,w.jsx)(`div`,{className:`p-4 h-full overflow-y-auto`,children:(0,w.jsx)(T,{conversations:s,currentConversationId:n,onDelete:g})})]}),(0,w.jsx)(i,{context:{openCreateDialog:O}})]}):(0,w.jsxs)(`div`,{className:`flex flex-col h-[calc(100vh-4rem)]`,children:[(0,w.jsx)(`div`,{className:`shrink-0 border-b pb-4`,children:(0,w.jsx)(D,{open:y,onOpenChange:b,title:`Select Chat`,trigger:(0,w.jsxs)(m,{variant:`ghost`,role:`combobox`,className:`gap-x-2 text-lg font-semibold h-8 py-4 mx-4 cursor-pointer`,children:[(0,w.jsx)(u,{className:`-ml-1 h-4 w-4 shrink-0 opacity-50`}),s.find(e=>e.id===n)?.title??`Select Chat`]}),children:(0,w.jsxs)(`div`,{className:`space-y-4`,children:[(0,w.jsxs)(m,{className:`w-full`,onClick:O,children:[(0,w.jsx)(d,{className:`h-4 w-4 mr-2`}),`New Chat`]}),(0,w.jsx)(S,{}),(0,w.jsx)(T,{conversations:s,currentConversationId:n,onDelete:g})]})})}),(0,w.jsxs)(`div`,{className:`flex-1 h-full flex overflow-y-auto`,children:[(0,w.jsx)(E,{hideTrigger:!0,isDialogOpen:_,setIsDialogOpen:v,handleCreateConversation:e=>(b(!1),h(e))}),(0,w.jsx)(i,{context:{openCreateDialog:O}})]})]})};const N=()=>n(),P=M;P.displayName=`ChatLayout`;var F=P;export{P as Component,F as default,N as useCreateChatDialog};