import{H as e,K as t,W as n,g as r,n as i,w as a,x as o}from"./index-DkHy_0vr.js";import{t as s}from"./createLucideIcon-CjtwccN9.js";import{t as c}from"./file-text-DkKZTnPR.js";import{t as l}from"./message-square-ZMYuK18L.js";import{r as u}from"./dist-UfzXyJyC.js";import{t as d}from"./button-CVZMqZS2.js";import{t as f}from"./textarea-DnKqqzBp.js";import{i as p,n as m,r as h,t as g}from"./tooltip-rsStB9Uj.js";import{t as _}from"./RelativeTime-DWnDX8Ey.js";var v=s(`send`,[[`path`,{d:`M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z`,key:`1ffxy3`}],[`path`,{d:`m21.854 2.147-10.94 10.939`,key:`12cjpa`}]]),y=t(n()),b=t(a()),x=(({isSelected:e,onClick:t,leadingIcon:n,label:r,children:i})=>(0,b.jsxs)(g,{children:[(0,b.jsx)(p,{asChild:!0,children:(0,b.jsxs)(d,{variant:e?`default`:`outline`,size:`sm`,onClick:t,className:u(`h-8 px-3`,e&&`bg-blue-600 hover:bg-blue-700`),children:[n&&(0,b.jsx)(n,{className:`h-4 w-4 mr-1`}),r]})}),(0,b.jsx)(m,{children:i})]})),S=[{Icon:void 0,type:`all`,label:`All`,tooltip:`Search across all course content`},{Icon:l,type:`discussions`,label:`Discussions`,tooltip:`Only search discussion posts`},{Icon:c,type:`files`,label:`Files`,tooltip:`Only search course files and materials`}],C=(0,y.memo)((({selectedContext:e,onContextChange:t})=>(0,b.jsx)(h,{children:(0,b.jsxs)(`div`,{className:`flex items-center gap-2 p-2 border-b`,children:[(0,b.jsx)(`span`,{className:`text-sm text-gray-600 dark:text-gray-400`,children:`Context:`}),(0,b.jsx)(`div`,{className:`flex gap-1`,children:S.map(({Icon:n,type:r,label:i,tooltip:a})=>(0,b.jsx)(x,{isSelected:e===r,onClick:()=>t(r),leadingIcon:n,label:i,children:(0,b.jsx)(`p`,{children:a})},r))})]})}))),w=t(e()),T=(0,y.memo)((({message:e})=>{let t=e.role===`user`;return(0,b.jsx)(`div`,{className:u(`flex w-full mb-4`,t?`justify-end`:`justify-start`),children:(0,b.jsxs)(`div`,{className:u(`max-w-[70%] rounded-lg px-4 py-3`,t?`bg-blue-600 text-white`:`bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100`),children:[(0,b.jsx)(`div`,{className:`text-sm whitespace-pre-wrap wrap-break-word`,children:e.content}),(0,b.jsx)(`div`,{className:u(`text-xs mt-1`,t?`text-blue-100`:`text-gray-500 dark:text-gray-400`),children:(0,b.jsx)(_,{className:`no-underline`,side:`right`,timestamp:(0,w.default)(e.createdAt)})})]})})})),E=(({messages:e,onSendMessage:t,isLoading:n=!1})=>{let[r,i]=(0,y.useState)(``),[a,o]=(0,y.useState)(`all`),s=(0,y.useRef)(null),c=()=>{s.current?.scrollIntoView({behavior:`smooth`})};(0,y.useEffect)(()=>{c()},[e]);let l=async e=>{if(e.preventDefault(),!r.trim()||n)return;let o=r.trim();i(``),console.log(`Selected context:`,a),await t(o)};return(0,b.jsxs)(`div`,{className:`flex flex-col h-full`,children:[(0,b.jsx)(C,{selectedContext:a,onContextChange:o}),(0,b.jsxs)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:[e.length===0?(0,b.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-500`,children:(0,b.jsxs)(`div`,{className:`text-center`,children:[(0,b.jsx)(`p`,{className:`text-lg mb-2`,children:`Start a conversation`}),(0,b.jsxs)(`p`,{className:`text-sm`,children:[`Ask me anything about the`,` `,a===`all`?`course`:a===`discussions`?`course discussions`:`course files`,`!`]})]})}):(0,b.jsxs)(b.Fragment,{children:[e.map(e=>(0,b.jsx)(T,{message:e},e.id)),(0,b.jsx)(`div`,{ref:s})]}),n&&(0,b.jsx)(`div`,{className:`flex justify-start mb-4`,children:(0,b.jsx)(`div`,{className:`bg-gray-200 dark:bg-gray-700 rounded-lg px-4 py-3`,children:(0,b.jsxs)(`div`,{className:`flex gap-1`,children:[(0,b.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce`}),(0,b.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce`,style:{animationDelay:`0.1s`}}),(0,b.jsx)(`div`,{className:`w-2 h-2 bg-gray-500 dark:bg-gray-400  rounded-full animate-bounce`,style:{animationDelay:`0.2s`}})]})})})]}),(0,b.jsx)(`div`,{className:`border-t p-4`,children:(0,b.jsxs)(`form`,{onSubmit:l,className:`flex gap-2`,children:[(0,b.jsx)(f,{value:r,onChange:e=>i(e.target.value),onKeyDown:e=>{e.key===`Enter`&&!e.shiftKey&&(e.preventDefault(),l(e))},placeholder:`Ask about course discussions...`,className:`resize-none`,disabled:n}),(0,b.jsx)(d,{type:`submit`,size:`icon`,disabled:!r.trim()||n,className:`self-end`,children:(0,b.jsx)(v,{})})]})})]})});const D={breadcrumb:e=>{let{conversation:t}=e.loaderData;return t?`Chat: ${t.title}`:`Loading...`}},O=(async({params:e})=>{let t=e.conversationId;return await k(Number(t))});var k=async e=>{try{let t=await i.GET(`/api/v1/conversations/{conversationId}`,{params:{path:{conversationId:Number(e)}}});if(!t.data)return window.alert(`Something went wrong loading the conversation.`),{conversation:null,messages:null};let n=await i.GET(`/api/v1/conversations/{conversationId}/messages`,{params:{path:{conversationId:Number(e)}}});return{conversation:t.data,messages:n.data??null}}catch(e){return window.alert(`Failed to load conversation data: ${e instanceof Error?e.message:e}`),{conversation:null,messages:null}}};const A=()=>{let e=r(),{conversationId:t}=o(),[n,a]=(0,y.useState)(e.messages?.messages??[]),[s,c]=(0,y.useState)(!1);return(0,y.useEffect)(()=>{a(e.messages?.messages??[])},[e.messages]),(0,b.jsx)(`div`,{className:`flex-1`,children:e.conversation?(0,b.jsxs)(`div`,{className:`h-full flex flex-col`,children:[(0,b.jsx)(`div`,{className:`hidden md:block border-b p-4`,children:(0,b.jsx)(`h2`,{className:`text-lg font-semibold`,children:e.conversation.title})}),(0,b.jsx)(`div`,{className:`flex-1 min-h-0`,children:(0,b.jsx)(E,{messages:n,onSendMessage:async e=>{if(t){c(!0);try{let r=await i.POST(`/api/v1/conversations/{conversationId}/messages`,{params:{path:{conversationId:Number(t)}},body:{content:e}});r.data&&a([...n,r.data.userMessage,r.data.assistantMessage])}catch(e){console.error(`Failed to send message:`,e),alert(`Failed to send message`)}finally{c(!1)}}},isLoading:s})})]}):(0,b.jsx)(`div`,{className:`flex items-center justify-center h-full text-gray-500`,children:(0,b.jsx)(`p`,{children:`Loading conversation...`})})})};A.displayName=`ChatConversation`;var j=A;export{A as Component,j as default,D as handle,O as loader};