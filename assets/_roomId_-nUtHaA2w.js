import{a as e,c as t,o as n,t as r,u as i}from"./index-DS1vxD5k.js";import{t as a}from"./iconify-xjcRTKRC.js";import{t as o}from"./clsx-DMxib4s8.js";import{n as s,r as c,t as l}from"./api-Dmbt9qQ0.js";import{n as u}from"./time-BvZKdqen.js";import{t as d}from"./store-DadTkLRX.js";var f=i(t(),1),p=i(r(),1);function m({roomCode:e,timeRemaining:t}){let[n,r,i]=u(t);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(`h1`,{className:`text-xl font-bold`,children:`Room Code:`}),(0,p.jsx)(`p`,{className:`font-mono text-4xl`,children:e}),(0,p.jsx)(`p`,{children:`Time Remaining:`}),(0,p.jsxs)(`p`,{className:`font-bold text-2xl`,children:[n.toString().padStart(2,`0`),`:`,r.toString().padStart(2,`0`),`:`,i.toString().padStart(2,`0`)]})]})}var h=m,g=()=>navigator.mediaDevices.getUserMedia({audio:!0});const _=({onStart:e,onStop:t,onData:n})=>{let[r,i]=(0,f.useState)(null);(0,f.useEffect)(()=>{r&&(r.ondataavailable=e=>{e.data.size>0&&n(e.data)})},[r,n]);let a=(0,f.useCallback)(async()=>{try{let e=await g(),t=new MediaRecorder(e,{mimeType:s});i(t),t.start(100)}catch(e){console.error(`Error accessing microphone:`,e)}},[]),o=(0,f.useCallback)(()=>{r?.state===`recording`&&r.stop(),r?.stream.getTracks().forEach(e=>e.stop())},[r]);return{start:(0,f.useCallback)(()=>{a(),e?.()},[a]),stop:(0,f.useCallback)(()=>{o(),t?.()},[o])}};var v={RTS(e){return`RTS${e}`},CTS:`CTS`,STOP:`STOP`,RESET:`RESET`};const y=(e,t)=>{let[n,r]=(0,f.useState)(`off`),[i,a]=(0,f.useState)(null);(0,f.useEffect)(()=>{let t=new WebSocket(e);return t.onopen=()=>{console.debug(`Connected to server`)},t.onclose=()=>{console.debug(`Disconnected from server`)},t.onmessage=({data:e})=>{console.debug(`Received message => ${e}`),e===v.CTS?r(()=>`on`):e===v.RESET&&r(()=>`off`)},a(t),()=>{console.debug(`Closing connection to server`),t.close(),a(null)}},[e]);let o=(0,f.useCallback)(e=>{i?.readyState===WebSocket.OPEN&&i.send(e)},[i]);return{state:n,send:(0,f.useCallback)(e=>{n===`on`&&o(e)},[o,n]),beginStream:(0,f.useCallback)(()=>{r(()=>`waiting`),o(v.RTS(t))},[o,t]),endStream:(0,f.useCallback)(()=>{o(v.STOP),r(()=>`off`)},[o])}};function b(){let{roomId:t}=n(),{state:r,send:i,beginStream:s,endStream:u}=y(`${c}/${t}`,`anonymous`),{start:m,stop:g}=_({onData:i}),v=e(),[b,x]=(0,f.useState)(2**53-1);(0,f.useEffect)(()=>{(async()=>{let e=await l.rooms.getTtl(t);if(!e){d.auth.setUserId(null),v(`/`);return}x(e)})();let e=setInterval(()=>{x(e=>e<=1e3?(d.auth.setUserId(null),v(`/`),0):e-1e3)},1e3);return()=>{clearInterval(e),x(2**53-1)}},[v,t]);let[S,C]=(0,f.useState)(!1);return(0,f.useEffect)(()=>{S&&r===`on`?m():g()},[r,S]),(0,p.jsxs)(`div`,{className:`space-y-4 text-center`,children:[(0,p.jsx)(h,{roomCode:t,timeRemaining:b}),(0,p.jsx)(`hr`,{className:`w-96 mx-auto`}),(0,p.jsxs)(`div`,{className:`flex flex-col gap-y-4 justify-center items-center h-96`,children:[(0,p.jsx)(`button`,{className:o(`w-40 h-40 rounded-full text-white font-bold`,`text-7xl flex justify-center items-center`,r===`on`&&`bg-green-500`,r===`waiting`&&`bg-orange-500`,r===`off`&&`bg-blue-500`),onClick:()=>{S?u():s(),C(e=>!e)},children:(0,p.jsx)(a,{icon:`tabler:microphone`})}),(0,p.jsx)(`p`,{children:r})]}),(0,p.jsx)(`button`,{className:o(`px-4 py-2 bg-red-500 text-white`,`font-semibold`,`hover:bg-red-600 rounded-lg`),onClick:()=>{d.auth.setUserId(null),v(`/`)},children:`Leave`})]})}const x=b;export{x as Component};