import{K as e,T as t,Z as n,b as r,f as i,m as a,n as o,s,x as c,y as l}from"./index-Ra2lGJdp.js";import{t as u}from"./utils-AMbbdZOx.js";import{t as d}from"./button-ZbUugITV.js";import{t as f}from"./chevrons-up-down-B0Yi-xZ7.js";import{t as p}from"./plus-DHQX-CAp.js";import{t as m}from"./trash-2-tH3XFeSR.js";import{t as h}from"./input-DWGpcTdi.js";import{t as g}from"./separator-BVBrznAq.js";import"./es2015-B0iSd3k2.js";import{c as _,o as v,r as y,s as b,t as x}from"./dialog-ZgoMsabM.js";import{t as S}from"./label-qYupBdTo.js";var C=n(e()),w=n(t());function T({conversations:e,currentConversationId:t,onDelete:n}){let r=c().courseId;return(0,w.jsx)(`div`,{className:`space-y-2`,children:e.length===0?(0,w.jsx)(`p`,{className:`text-sm text-gray-500 text-center py-8`,children:`No conversations yet. Start a new chat!`}):e.map(e=>(0,w.jsxs)(i,{to:`/courses/${r}/chat/${e.id}`,className:u(`flex items-center gap-2 rounded-lg p-3 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors`,t===e.id&&`bg-gray-100 dark:bg-gray-800`),children:[(0,w.jsx)(`span`,{className:`flex-1 min-w-0`,children:(0,w.jsx)(`div`,{className:`text-sm font-medium truncate`,children:e.title})}),n&&(0,w.jsx)(d,{variant:`ghost`,size:`icon`,className:`h-8 w-8 shrink-0 cursor-pointer hover:text-red-600`,onClick:t=>{t.preventDefault(),n(e.id)},children:(0,w.jsx)(m,{className:`h-4 w-4`})})]},e.id))})}var E=T;function D({isDialogOpen:e,hideTrigger:t=!1,setIsDialogOpen:n,handleCreateConversation:r}){let[i,a]=(0,C.useState)(``),[o,s]=(0,C.useState)(!1),c=async e=>{if(!e.trim()){window.alert(`Chat title cannot be empty`);return}s(!0);try{await r(e)}catch(e){console.error(`Failed to create conversation:`,e),window.alert(`Failed to create conversation`)}finally{s(!1)}};return(0,w.jsxs)(x,{open:e,onOpenChange:n,children:[!t&&(0,w.jsx)(_,{asChild:!0,children:(0,w.jsxs)(d,{className:`w-full`,children:[(0,w.jsx)(p,{className:`h-4 w-4 mr-2`}),`New Chat`]})}),(0,w.jsxs)(y,{children:[(0,w.jsx)(v,{children:(0,w.jsx)(b,{children:`Start a New Chat`})}),(0,w.jsxs)(`div`,{className:`space-y-4 pt-4`,children:[(0,w.jsxs)(`div`,{className:`space-y-2`,children:[(0,w.jsx)(S,{htmlFor:`title`,children:`Chat Title`}),(0,w.jsx)(h,{id:`title`,value:i,onChange:e=>a(e.target.value),placeholder:`e.g., Midterm Discussion Summary`,onKeyDown:e=>{e.key===`Enter`&&c(i)}})]}),(0,w.jsx)(d,{onClick:()=>c(i),disabled:!i.trim()||o,className:`w-full`,children:`Create Chat`})]})]})]})}var O=D;function k({open:e,onOpenChange:t,title:n,trigger:r,children:i}){return(0,w.jsxs)(x,{open:e,onOpenChange:t,children:[(0,w.jsx)(_,{asChild:!0,children:r}),(0,w.jsxs)(y,{className:`sm:max-w-lg w-full`,children:[(0,w.jsx)(v,{children:(0,w.jsx)(b,{children:n})}),(0,w.jsx)(`div`,{children:i})]})]})}var A=k,j={sm:0,md:1,lg:2,xl:3,xxl:4},M=[640,768,1024,1280,1536],N=e=>{let t=M.length-1;for(;t>=0&&!(e>=M[t]);t--);return t};const P=()=>{let[e,t]=(0,C.useState)(N(window.innerWidth));return(0,C.useEffect)(()=>{let e=()=>{window.requestAnimationFrame(()=>{t(N(window.innerWidth))})};return window.addEventListener(`resize`,e),window.addEventListener(`orientationchange`,e),()=>{window.removeEventListener(`resize`,e),window.removeEventListener(`orientationchange`,e)}},[]),(0,C.useMemo)(()=>Object.fromEntries(Object.keys(j).map((t,n)=>[t,n<=e])),[e])};function F(){let e=c(),t=e.courseId,n=e.conversationId===void 0?void 0:Number(e.conversationId),r=s(e=>e.courses.currentCourseId),[i,u]=(0,C.useState)([]),m=l();(0,C.useEffect)(()=>{(async()=>{if(r)try{let e=await o.GET(`/api/v1/conversations`,{params:{query:{courseId:r}}});e.data&&u(e.data.conversations)}catch(e){console.error(`Failed to load conversations:`,e)}})()},[r]);let h=async e=>{if(!e.trim()||!r)return;let n=await o.POST(`/api/v1/conversations`,{body:{title:e.trim(),courseId:r}});n.data&&(u([...i,n.data]),y(!1),m(`/courses/${t}/chat/${n.data.id}`))},_=async e=>{if(confirm(`Are you sure you want to delete this conversation?`))try{await o.DELETE(`/api/v1/conversations/{conversationId}`,{params:{path:{conversationId:e}}}),u(i.filter(t=>t.id!==e)),e===n&&m(`/courses/${t}/chat`)}catch(e){console.error(`Failed to delete conversation:`,e),window.alert(`Failed to delete conversation`)}},[v,y]=(0,C.useState)(!1),[b,x]=(0,C.useState)(!1),{md:S}=P();(0,C.useEffect)(()=>{n!==void 0&&x(!1)},[n]);let T=()=>y(!0);return S?(0,w.jsxs)(`div`,{className:`flex h-[calc(100vh-4rem)]`,children:[(0,w.jsxs)(`div`,{className:`w-80 border-r flex flex-col`,children:[(0,w.jsx)(`div`,{className:`p-4 border-b`,children:(0,w.jsx)(O,{isDialogOpen:v,setIsDialogOpen:y,handleCreateConversation:h})}),(0,w.jsx)(`div`,{className:`p-4 h-full overflow-y-auto`,children:(0,w.jsx)(E,{conversations:i,currentConversationId:n,onDelete:_})})]}),(0,w.jsx)(a,{context:{openCreateDialog:T}})]}):(0,w.jsxs)(`div`,{className:`flex flex-col h-[calc(100vh-4rem)]`,children:[(0,w.jsx)(`div`,{className:`shrink-0 border-b pb-4`,children:(0,w.jsx)(A,{open:b,onOpenChange:x,title:`Select Chat`,trigger:(0,w.jsxs)(d,{variant:`ghost`,role:`combobox`,className:`gap-x-2 text-lg font-semibold h-8 py-4 mx-4 cursor-pointer`,children:[(0,w.jsx)(f,{className:`-ml-1 h-4 w-4 shrink-0 opacity-50`}),i.find(e=>e.id===n)?.title??`Select Chat`]}),children:(0,w.jsxs)(`div`,{className:`space-y-4`,children:[(0,w.jsxs)(d,{className:`w-full`,onClick:T,children:[(0,w.jsx)(p,{className:`h-4 w-4 mr-2`}),`New Chat`]}),(0,w.jsx)(g,{}),(0,w.jsx)(E,{conversations:i,currentConversationId:n,onDelete:_})]})})}),(0,w.jsxs)(`div`,{className:`flex-1 h-full flex overflow-y-auto`,children:[(0,w.jsx)(O,{hideTrigger:!0,isDialogOpen:v,setIsDialogOpen:y,handleCreateConversation:e=>(x(!1),h(e))}),(0,w.jsx)(a,{context:{openCreateDialog:T}})]})]})}const I=()=>r(),L=F;export{L as Component,I as useCreateChatDialog};